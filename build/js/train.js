(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";var _Mathpow=Math.pow,_Mathmin=Math.min,_Mathmax=Math.max,_Mathexp=Math.exp,_Mathfloor=Math.floor,_Mathsqrt=Math.sqrt,_Mathlog=Math.log,convnetjs=convnetjs||{REVISION:"ALPHA"};(function(J){var L=!1,M=0,N=function l(){if(L)return L=!1,M;var Y=2*Math.random()-1,Z=2*Math.random()-1,$=Y*Y+Z*Z;if(0==$||1<$)return N();var _=_Mathsqrt(-2*_Mathlog($)/$);return M=Z*_,L=!0,Y*_},O=function i(Y,Z){return Math.random()*(Z-Y)+Y},S=function n(Y,Z){for(var $=0,_=Y.length;$<_;$++)if(Y[$]===Z)return!0;return!1};J.randf=O,J.randi=function g(Y,Z){return _Mathfloor(Math.random()*(Z-Y)+Y)},J.randn=function c(Y,Z){return Y+N()*Z},J.zeros=function f(Y){if("undefined"==typeof Y||isNaN(Y))return[];if("undefined"==typeof ArrayBuffer){for(var Z=Array(Y),$=0;$<Y;$++)Z[$]=0;return Z}return new Float64Array(Y)},J.maxmin=function b(Y){if(0===Y.length)return{};for(var Z=Y[0],$=Y[0],_=0,aa=0,ba=Y.length,ca=1;ca<ba;ca++)Y[ca]>Z&&(Z=Y[ca],_=ca),Y[ca]<$&&($=Y[ca],aa=ca);return{maxi:_,maxv:Z,mini:aa,minv:$,dv:Z-$}},J.randperm=function j(Y){for(var _,Z=Y,$=0,aa=[],ba=0;ba<Y;ba++)aa[ba]=ba;for(;Z--;)$=_Mathfloor(Math.random()*(Z+1)),_=aa[Z],aa[Z]=aa[$],aa[$]=_;return aa},J.weightedSample=function h(Y,Z){for(var $=O(0,1),_=0,aa=0,ba=Y.length;aa<ba;aa++)if(_+=Z[aa],$<_)return Y[aa]},J.arrUnique=function o(Y){for(var Z=[],$=0,_=Y.length;$<_;$++)S(Z,Y[$])||Z.push(Y[$]);return Z},J.arrContains=S,J.getopt=function m(Y,Z,$){if("string"==typeof Z)return"undefined"==typeof Y[Z]?$:Y[Z];for(var ba,_=$,aa=0;aa<Z.length;aa++)ba=Z[aa],"undefined"!=typeof Y[ba]&&(_=Y[ba]);return _},J.assert=function(Y,Z){if(!Y){if(Z=Z||"Assertion failed","undefined"!=typeof Error)throw new Error(Z);throw Z}}})(convnetjs),function(J){var K=function a(L,M,N,O){if("[object Array]"===Object.prototype.toString.call(L)){this.sx=1,this.sy=1,this.depth=L.length,this.w=J.zeros(this.depth),this.dw=J.zeros(this.depth);for(var P=0;P<this.depth;P++)this.w[P]=L[P]}else{this.sx=L,this.sy=M,this.depth=N;var Q=L*M*N;if(this.w=J.zeros(Q),this.dw=J.zeros(Q),"undefined"==typeof O)for(var R=_Mathsqrt(1/(L*M*N)),P=0;P<Q;P++)this.w[P]=J.randn(0,R);else for(var P=0;P<Q;P++)this.w[P]=O}};K.prototype={get:function get(L,M,N){var O=(this.sx*M+L)*this.depth+N;return this.w[O]},set:function set(L,M,N,O){var P=(this.sx*M+L)*this.depth+N;this.w[P]=O},add:function add(L,M,N,O){var P=(this.sx*M+L)*this.depth+N;this.w[P]+=O},get_grad:function get_grad(L,M,N){var O=(this.sx*M+L)*this.depth+N;return this.dw[O]},set_grad:function set_grad(L,M,N,O){var P=(this.sx*M+L)*this.depth+N;this.dw[P]=O},add_grad:function add_grad(L,M,N,O){var P=(this.sx*M+L)*this.depth+N;this.dw[P]+=O},cloneAndZero:function cloneAndZero(){return new K(this.sx,this.sy,this.depth,0)},clone:function clone(){for(var L=new K(this.sx,this.sy,this.depth,0),M=this.w.length,N=0;N<M;N++)L.w[N]=this.w[N];return L},addFrom:function addFrom(L){for(var M=0;M<this.w.length;M++)this.w[M]+=L.w[M]},addFromScaled:function addFromScaled(L,M){for(var N=0;N<this.w.length;N++)this.w[N]+=M*L.w[N]},setConst:function setConst(L){for(var M=0;M<this.w.length;M++)this.w[M]=L},toJSON:function toJSON(){var L={sx:this.sx,sy:this.sy,depth:this.depth,w:this.w};return L},fromJSON:function fromJSON(L){this.sx=L.sx,this.sy=L.sy,this.depth=L.depth;var M=this.sx*this.sy*this.depth;this.w=J.zeros(M),this.dw=J.zeros(M);for(var N=0;N<M;N++)this.w[N]=L.w[N]}},J.Vol=K}(convnetjs),function(J){var K=J.Vol;J.augment=function b(N,O,P,Q,R){if("undefined"==typeof R)var R=!1;if("undefined"==typeof P)var P=J.randi(0,N.sx-O);if("undefined"==typeof Q)var Q=J.randi(0,N.sy-O);var S;if(O!==N.sx||0!==P||0!==Q){S=new K(O,O,N.depth,0);for(var T=0;T<O;T++)for(var U=0;U<O;U++)if(!(0>T+P||T+P>=N.sx||0>U+Q||U+Q>=N.sy))for(var V=0;V<N.depth;V++)S.set(T,U,V,N.get(T+P,U+Q,V))}else S=N;if(R){for(var W=S.cloneAndZero(),T=0;T<S.sx;T++)for(var U=0;U<S.sy;U++)for(var V=0;V<S.depth;V++)W.set(T,U,V,S.get(S.sx-T-1,U,V));S=W}return S},J.img_to_vol=function d(N,O){if("undefined"==typeof O)var O=!1;var P=document.createElement("canvas");P.width=N.width,P.height=N.height;var Q=P.getContext("2d");try{Q.drawImage(N,0,0)}catch($){if("NS_ERROR_NOT_AVAILABLE"===$.name)return!1;throw $}try{var R=Q.getImageData(0,0,P.width,P.height)}catch($){if("IndexSizeError"===$.name)return!1;throw $}for(var S=R.data,T=N.width,U=N.height,V=[],W=0;W<S.length;W++)V.push(S[W]/255-0.5);var X=new K(T,U,4,0);if(X.w=V,O){for(var Y=new K(T,U,1,0),W=0;W<T;W++)for(var Z=0;Z<U;Z++)Y.set(W,Z,0,X.get(W,Z,0));X=Y}return X}}(convnetjs),function(J){var K=J.Vol,L=function d(N){var N=N||{};this.out_depth=N.filters,this.sx=N.sx,this.in_depth=N.in_depth,this.in_sx=N.in_sx,this.in_sy=N.in_sy,this.sy="undefined"==typeof N.sy?this.sx:N.sy,this.stride="undefined"==typeof N.stride?1:N.stride,this.pad="undefined"==typeof N.pad?0:N.pad,this.l1_decay_mul="undefined"==typeof N.l1_decay_mul?0:N.l1_decay_mul,this.l2_decay_mul="undefined"==typeof N.l2_decay_mul?1:N.l2_decay_mul,this.out_sx=_Mathfloor((this.in_sx+2*this.pad-this.sx)/this.stride+1),this.out_sy=_Mathfloor((this.in_sy+2*this.pad-this.sy)/this.stride+1),this.layer_type="conv";var O="undefined"==typeof N.bias_pref?0:N.bias_pref;this.filters=[];for(var P=0;P<this.out_depth;P++)this.filters.push(new K(this.sx,this.sy,this.in_depth));this.biases=new K(1,1,this.out_depth,O)};L.prototype={forward:function forward(N){this.in_act=N;for(var P=new K(0|this.out_sx,0|this.out_sy,0|this.out_depth,0),Q=0|N.sx,R=0|N.sy,S=0|this.stride,T=0;T<this.out_depth;T++)for(var U=this.filters[T],V=0|-this.pad,W=0|-this.pad,X=0;X<this.out_sy;W+=S,X++){V=0|-this.pad;for(var Z,Y=0;Y<this.out_sx;V+=S,Y++){Z=0;for(var _,$=0;$<U.sy;$++){_=W+$;for(var ba,aa=0;aa<U.sx;aa++)if(ba=V+aa,0<=_&&_<R&&0<=ba&&ba<Q)for(var ca=0;ca<U.depth;ca++)Z+=U.w[(U.sx*$+aa)*U.depth+ca]*N.w[(Q*_+ba)*N.depth+ca]}Z+=this.biases.w[T],P.set(Y,X,T,Z)}}return this.out_act=P,this.out_act},backward:function backward(){var N=this.in_act;N.dw=J.zeros(N.w.length);for(var O=0|N.sx,P=0|N.sy,Q=0|this.stride,R=0;R<this.out_depth;R++)for(var S=this.filters[R],T=0|-this.pad,U=0|-this.pad,V=0;V<this.out_sy;U+=Q,V++){T=0|-this.pad;for(var X,W=0;W<this.out_sx;T+=Q,W++){X=this.out_act.get_grad(W,V,R);for(var Z,Y=0;Y<S.sy;Y++){Z=U+Y;for(var _,$=0;$<S.sx;$++)if(_=T+$,0<=Z&&Z<P&&0<=_&&_<O)for(var aa=0;aa<S.depth;aa++){var ba=(O*Z+_)*N.depth+aa,ca=(S.sx*Y+$)*S.depth+aa;S.dw[ca]+=N.w[ba]*X,N.dw[ba]+=S.w[ca]*X}}this.biases.dw[R]+=X}}},getParamsAndGrads:function getParamsAndGrads(){for(var N=[],O=0;O<this.out_depth;O++)N.push({params:this.filters[O].w,grads:this.filters[O].dw,l2_decay_mul:this.l2_decay_mul,l1_decay_mul:this.l1_decay_mul});return N.push({params:this.biases.w,grads:this.biases.dw,l1_decay_mul:0,l2_decay_mul:0}),N},toJSON:function toJSON(){for(var N={sx:this.sx,sy:this.sy,stride:this.stride,in_depth:this.in_depth,out_depth:this.out_depth,out_sx:this.out_sx,out_sy:this.out_sy,layer_type:this.layer_type,l1_decay_mul:this.l1_decay_mul,l2_decay_mul:this.l2_decay_mul,pad:this.pad,filters:[]},O=0;O<this.filters.length;O++)N.filters.push(this.filters[O].toJSON());return N.biases=this.biases.toJSON(),N},fromJSON:function fromJSON(N){this.out_depth=N.out_depth,this.out_sx=N.out_sx,this.out_sy=N.out_sy,this.layer_type=N.layer_type,this.sx=N.sx,this.sy=N.sy,this.stride=N.stride,this.in_depth=N.in_depth,this.filters=[],this.l1_decay_mul="undefined"==typeof N.l1_decay_mul?1:N.l1_decay_mul,this.l2_decay_mul="undefined"==typeof N.l2_decay_mul?1:N.l2_decay_mul,this.pad="undefined"==typeof N.pad?0:N.pad;for(var P,O=0;O<N.filters.length;O++)P=new K(0,0,0,0),P.fromJSON(N.filters[O]),this.filters.push(P);this.biases=new K(0,0,0,0),this.biases.fromJSON(N.biases)}};var M=function b(N){var N=N||{};this.out_depth="undefined"==typeof N.num_neurons?N.filters:N.num_neurons,this.l1_decay_mul="undefined"==typeof N.l1_decay_mul?0:N.l1_decay_mul,this.l2_decay_mul="undefined"==typeof N.l2_decay_mul?1:N.l2_decay_mul,this.num_inputs=N.in_sx*N.in_sy*N.in_depth,this.out_sx=1,this.out_sy=1,this.layer_type="fc";var O="undefined"==typeof N.bias_pref?0:N.bias_pref;this.filters=[];for(var P=0;P<this.out_depth;P++)this.filters.push(new K(1,1,this.num_inputs));this.biases=new K(1,1,this.out_depth,O)};M.prototype={forward:function forward(N){this.in_act=N;for(var P=new K(1,1,this.out_depth,0),Q=N.w,R=0;R<this.out_depth;R++){for(var S=0,T=this.filters[R].w,U=0;U<this.num_inputs;U++)S+=Q[U]*T[U];S+=this.biases.w[R],P.w[R]=S}return this.out_act=P,this.out_act},backward:function backward(){var N=this.in_act;N.dw=J.zeros(N.w.length);for(var O=0;O<this.out_depth;O++){for(var P=this.filters[O],Q=this.out_act.dw[O],R=0;R<this.num_inputs;R++)N.dw[R]+=P.w[R]*Q,P.dw[R]+=N.w[R]*Q;this.biases.dw[O]+=Q}},getParamsAndGrads:function getParamsAndGrads(){for(var N=[],O=0;O<this.out_depth;O++)N.push({params:this.filters[O].w,grads:this.filters[O].dw,l1_decay_mul:this.l1_decay_mul,l2_decay_mul:this.l2_decay_mul});return N.push({params:this.biases.w,grads:this.biases.dw,l1_decay_mul:0,l2_decay_mul:0}),N},toJSON:function toJSON(){for(var N={out_depth:this.out_depth,out_sx:this.out_sx,out_sy:this.out_sy,layer_type:this.layer_type,num_inputs:this.num_inputs,l1_decay_mul:this.l1_decay_mul,l2_decay_mul:this.l2_decay_mul,filters:[]},O=0;O<this.filters.length;O++)N.filters.push(this.filters[O].toJSON());return N.biases=this.biases.toJSON(),N},fromJSON:function fromJSON(N){this.out_depth=N.out_depth,this.out_sx=N.out_sx,this.out_sy=N.out_sy,this.layer_type=N.layer_type,this.num_inputs=N.num_inputs,this.l1_decay_mul="undefined"==typeof N.l1_decay_mul?1:N.l1_decay_mul,this.l2_decay_mul="undefined"==typeof N.l2_decay_mul?1:N.l2_decay_mul,this.filters=[];for(var P,O=0;O<N.filters.length;O++)P=new K(0,0,0,0),P.fromJSON(N.filters[O]),this.filters.push(P);this.biases=new K(0,0,0,0),this.biases.fromJSON(N.biases)}},J.ConvLayer=L,J.FullyConnLayer=M}(convnetjs),function(J){var K=J.Vol,L=function b(M){var M=M||{};this.sx=M.sx,this.in_depth=M.in_depth,this.in_sx=M.in_sx,this.in_sy=M.in_sy,this.sy="undefined"==typeof M.sy?this.sx:M.sy,this.stride="undefined"==typeof M.stride?2:M.stride,this.pad="undefined"==typeof M.pad?0:M.pad,this.out_depth=this.in_depth,this.out_sx=_Mathfloor((this.in_sx+2*this.pad-this.sx)/this.stride+1),this.out_sy=_Mathfloor((this.in_sy+2*this.pad-this.sy)/this.stride+1),this.layer_type="pool",this.switchx=J.zeros(this.out_sx*this.out_sy*this.out_depth),this.switchy=J.zeros(this.out_sx*this.out_sy*this.out_depth)};L.prototype={forward:function forward(M){this.in_act=M;for(var O=new K(this.out_sx,this.out_sy,this.out_depth,0),P=0,Q=0;Q<this.out_depth;Q++)for(var R=-this.pad,S=-this.pad,T=0;T<this.out_sx;R+=this.stride,T++){S=-this.pad;for(var U=0;U<this.out_sy;S+=this.stride,U++){for(var V=-99999,W=-1,X=-1,Y=0;Y<this.sx;Y++)for(var Z=0;Z<this.sy;Z++){var $=S+Z,_=R+Y;if(0<=$&&$<M.sy&&0<=_&&_<M.sx){var aa=M.get(_,$,Q);aa>V&&(V=aa,W=_,X=$)}}this.switchx[P]=W,this.switchy[P]=X,P++,O.set(T,U,Q,V)}}return this.out_act=O,this.out_act},backward:function backward(){var M=this.in_act;M.dw=J.zeros(M.w.length);for(var N=this.out_act,O=0,P=0;P<this.out_depth;P++)for(var Q=-this.pad,R=-this.pad,S=0;S<this.out_sx;Q+=this.stride,S++){R=-this.pad;for(var U,T=0;T<this.out_sy;R+=this.stride,T++)U=this.out_act.get_grad(S,T,P),M.add_grad(this.switchx[O],this.switchy[O],P,U),O++}},getParamsAndGrads:function getParamsAndGrads(){return[]},toJSON:function toJSON(){var M={sx:this.sx,sy:this.sy,stride:this.stride,in_depth:this.in_depth,out_depth:this.out_depth,out_sx:this.out_sx,out_sy:this.out_sy,layer_type:this.layer_type,pad:this.pad};return M},fromJSON:function fromJSON(M){this.out_depth=M.out_depth,this.out_sx=M.out_sx,this.out_sy=M.out_sy,this.layer_type=M.layer_type,this.sx=M.sx,this.sy=M.sy,this.stride=M.stride,this.in_depth=M.in_depth,this.pad="undefined"==typeof M.pad?0:M.pad,this.switchx=J.zeros(this.out_sx*this.out_sy*this.out_depth),this.switchy=J.zeros(this.out_sx*this.out_sy*this.out_depth)}},J.PoolLayer=L}(convnetjs),function(J){var K=J.Vol,L=J.getopt,M=function b(N){var N=N||{};this.out_depth=L(N,["out_depth","depth"],0),this.out_sx=L(N,["out_sx","sx","width"],1),this.out_sy=L(N,["out_sy","sy","height"],1),this.layer_type="input"};M.prototype={forward:function forward(N){return this.in_act=N,this.out_act=N,this.out_act},backward:function backward(){},getParamsAndGrads:function getParamsAndGrads(){return[]},toJSON:function toJSON(){var N={out_depth:this.out_depth,out_sx:this.out_sx,out_sy:this.out_sy,layer_type:this.layer_type};return N},fromJSON:function fromJSON(N){this.out_depth=N.out_depth,this.out_sx=N.out_sx,this.out_sy=N.out_sy,this.layer_type=N.layer_type}},J.InputLayer=M}(convnetjs),function(J){var K=J.Vol,L=function c(O){var O=O||{};this.num_inputs=O.in_sx*O.in_sy*O.in_depth,this.out_depth=this.num_inputs,this.out_sx=1,this.out_sy=1,this.layer_type="softmax"};L.prototype={forward:function forward(O){this.in_act=O;for(var Q=new K(1,1,this.out_depth,0),R=O.w,S=O.w[0],T=1;T<this.out_depth;T++)R[T]>S&&(S=R[T]);for(var W,U=J.zeros(this.out_depth),V=0,T=0;T<this.out_depth;T++)W=_Mathexp(R[T]-S),V+=W,U[T]=W;for(var T=0;T<this.out_depth;T++)U[T]/=V,Q.w[T]=U[T];return this.es=U,this.out_act=Q,this.out_act},backward:function backward(O){var P=this.in_act;P.dw=J.zeros(P.w.length);for(var Q=0;Q<this.out_depth;Q++){var R=Q===O?1:0,S=-(R-this.es[Q]);P.dw[Q]=S}return-_Mathlog(this.es[O])},getParamsAndGrads:function getParamsAndGrads(){return[]},toJSON:function toJSON(){var O={out_depth:this.out_depth,out_sx:this.out_sx,out_sy:this.out_sy,layer_type:this.layer_type,num_inputs:this.num_inputs};return O},fromJSON:function fromJSON(O){this.out_depth=O.out_depth,this.out_sx=O.out_sx,this.out_sy=O.out_sy,this.layer_type=O.layer_type,this.num_inputs=O.num_inputs}};var M=function d(O){var O=O||{};this.num_inputs=O.in_sx*O.in_sy*O.in_depth,this.out_depth=this.num_inputs,this.out_sx=1,this.out_sy=1,this.layer_type="regression"};M.prototype={forward:function forward(O){return this.in_act=O,this.out_act=O,O},backward:function backward(O){var P=this.in_act;P.dw=J.zeros(P.w.length);var Q=0;if(O instanceof Array||O instanceof Float64Array)for(var S,R=0;R<this.out_depth;R++)S=P.w[R]-O[R],P.dw[R]=S,Q+=0.5*S*S;else if("number"==typeof O){var S=P.w[0]-O;P.dw[0]=S,Q+=0.5*S*S}else{var R=O.dim,T=O.val,S=P.w[R]-T;P.dw[R]=S,Q+=0.5*S*S}return Q},getParamsAndGrads:function getParamsAndGrads(){return[]},toJSON:function toJSON(){var O={out_depth:this.out_depth,out_sx:this.out_sx,out_sy:this.out_sy,layer_type:this.layer_type,num_inputs:this.num_inputs};return O},fromJSON:function fromJSON(O){this.out_depth=O.out_depth,this.out_sx=O.out_sx,this.out_sy=O.out_sy,this.layer_type=O.layer_type,this.num_inputs=O.num_inputs}};var N=function b(O){var O=O||{};this.num_inputs=O.in_sx*O.in_sy*O.in_depth,this.out_depth=this.num_inputs,this.out_sx=1,this.out_sy=1,this.layer_type="svm"};N.prototype={forward:function forward(O){return this.in_act=O,this.out_act=O,O},backward:function backward(O){var P=this.in_act;P.dw=J.zeros(P.w.length);for(var Q=P.w[O],S=0,T=0;T<this.out_depth;T++)if(O!==T){var U=-Q+P.w[T]+1;0<U&&(P.dw[T]+=1,P.dw[O]-=1,S+=U)}return S},getParamsAndGrads:function getParamsAndGrads(){return[]},toJSON:function toJSON(){var O={out_depth:this.out_depth,out_sx:this.out_sx,out_sy:this.out_sy,layer_type:this.layer_type,num_inputs:this.num_inputs};return O},fromJSON:function fromJSON(O){this.out_depth=O.out_depth,this.out_sx=O.out_sx,this.out_sy=O.out_sy,this.layer_type=O.layer_type,this.num_inputs=O.num_inputs}},J.RegressionLayer=M,J.SoftmaxLayer=L,J.SVMLayer=N}(convnetjs),function(J){function K(Q){var R=_Mathexp(2*Q);return(R-1)/(R+1)}var L=J.Vol,M=function e(Q){var Q=Q||{};this.out_sx=Q.in_sx,this.out_sy=Q.in_sy,this.out_depth=Q.in_depth,this.layer_type="relu"};M.prototype={forward:function forward(Q){this.in_act=Q;for(var S=Q.clone(),T=Q.w.length,U=S.w,V=0;V<T;V++)0>U[V]&&(U[V]=0);return this.out_act=S,this.out_act},backward:function backward(){var Q=this.in_act,R=this.out_act,S=Q.w.length;Q.dw=J.zeros(S);for(var T=0;T<S;T++)Q.dw[T]=0>=R.w[T]?0:R.dw[T]},getParamsAndGrads:function getParamsAndGrads(){return[]},toJSON:function toJSON(){var Q={out_depth:this.out_depth,out_sx:this.out_sx,out_sy:this.out_sy,layer_type:this.layer_type};return Q},fromJSON:function fromJSON(Q){this.out_depth=Q.out_depth,this.out_sx=Q.out_sx,this.out_sy=Q.out_sy,this.layer_type=Q.layer_type}};var N=function g(Q){var Q=Q||{};this.out_sx=Q.in_sx,this.out_sy=Q.in_sy,this.out_depth=Q.in_depth,this.layer_type="sigmoid"};N.prototype={forward:function forward(Q){this.in_act=Q;for(var S=Q.cloneAndZero(),T=Q.w.length,U=S.w,V=Q.w,W=0;W<T;W++)U[W]=1/(1+_Mathexp(-V[W]));return this.out_act=S,this.out_act},backward:function backward(){var Q=this.in_act,R=this.out_act,S=Q.w.length;Q.dw=J.zeros(S);for(var U,T=0;T<S;T++)U=R.w[T],Q.dw[T]=U*(1-U)*R.dw[T]},getParamsAndGrads:function getParamsAndGrads(){return[]},toJSON:function toJSON(){var Q={out_depth:this.out_depth,out_sx:this.out_sx,out_sy:this.out_sy,layer_type:this.layer_type};return Q},fromJSON:function fromJSON(Q){this.out_depth=Q.out_depth,this.out_sx=Q.out_sx,this.out_sy=Q.out_sy,this.layer_type=Q.layer_type}};var O=function f(Q){var Q=Q||{};this.group_size="undefined"==typeof Q.group_size?2:Q.group_size,this.out_sx=Q.in_sx,this.out_sy=Q.in_sy,this.out_depth=_Mathfloor(Q.in_depth/this.group_size),this.layer_type="maxout",this.switches=J.zeros(this.out_sx*this.out_sy*this.out_depth)};O.prototype={forward:function forward(Q){this.in_act=Q;var S=this.out_depth,T=new L(this.out_sx,this.out_sy,this.out_depth,0);if(1===this.out_sx&&1===this.out_sy)for(var U=0;U<S;U++){for(var Z,V=U*this.group_size,W=Q.w[V],X=0,Y=1;Y<this.group_size;Y++)Z=Q.w[V+Y],Z>W&&(W=Z,X=Y);T.w[U]=W,this.switches[U]=V+X}else for(var $=0,_=0;_<Q.sx;_++)for(var aa=0;aa<Q.sy;aa++)for(var U=0;U<S;U++){for(var Z,V=U*this.group_size,W=Q.get(_,aa,V),X=0,Y=1;Y<this.group_size;Y++)Z=Q.get(_,aa,V+Y),Z>W&&(W=Z,X=Y);T.set(_,aa,U,W),this.switches[$]=V+X,$++}return this.out_act=T,this.out_act},backward:function backward(){var Q=this.in_act,R=this.out_act,S=this.out_depth;if(Q.dw=J.zeros(Q.w.length),1===this.out_sx&&1===this.out_sy)for(var U,T=0;T<S;T++)U=R.dw[T],Q.dw[this.switches[T]]=U;else for(var V=0,W=0;W<R.sx;W++)for(var X=0;X<R.sy;X++)for(var U,T=0;T<S;T++)U=R.get_grad(W,X,T),Q.set_grad(W,X,this.switches[V],U),V++},getParamsAndGrads:function getParamsAndGrads(){return[]},toJSON:function toJSON(){var Q={out_depth:this.out_depth,out_sx:this.out_sx,out_sy:this.out_sy,layer_type:this.layer_type,group_size:this.group_size};return Q},fromJSON:function fromJSON(Q){this.out_depth=Q.out_depth,this.out_sx=Q.out_sx,this.out_sy=Q.out_sy,this.layer_type=Q.layer_type,this.group_size=Q.group_size,this.switches=J.zeros(this.group_size)}};var P=function b(Q){var Q=Q||{};this.out_sx=Q.in_sx,this.out_sy=Q.in_sy,this.out_depth=Q.in_depth,this.layer_type="tanh"};P.prototype={forward:function forward(Q){this.in_act=Q;for(var S=Q.cloneAndZero(),T=Q.w.length,U=0;U<T;U++)S.w[U]=K(Q.w[U]);return this.out_act=S,this.out_act},backward:function backward(){var Q=this.in_act,R=this.out_act,S=Q.w.length;Q.dw=J.zeros(S);for(var U,T=0;T<S;T++)U=R.w[T],Q.dw[T]=(1-U*U)*R.dw[T]},getParamsAndGrads:function getParamsAndGrads(){return[]},toJSON:function toJSON(){var Q={out_depth:this.out_depth,out_sx:this.out_sx,out_sy:this.out_sy,layer_type:this.layer_type};return Q},fromJSON:function fromJSON(Q){this.out_depth=Q.out_depth,this.out_sx=Q.out_sx,this.out_sy=Q.out_sy,this.layer_type=Q.layer_type}},J.TanhLayer=P,J.MaxoutLayer=O,J.ReluLayer=M,J.SigmoidLayer=N}(convnetjs),function(J){var K=J.Vol,L=function b(M){var M=M||{};this.out_sx=M.in_sx,this.out_sy=M.in_sy,this.out_depth=M.in_depth,this.layer_type="dropout",this.drop_prob="undefined"==typeof M.drop_prob?0.5:M.drop_prob,this.dropped=J.zeros(this.out_sx*this.out_sy*this.out_depth)};L.prototype={forward:function forward(M,N){this.in_act=M,"undefined"==typeof N&&(N=!1);var O=M.clone(),P=M.w.length;if(N)for(var Q=0;Q<P;Q++)Math.random()<this.drop_prob?(O.w[Q]=0,this.dropped[Q]=!0):this.dropped[Q]=!1;else for(var Q=0;Q<P;Q++)O.w[Q]*=this.drop_prob;return this.out_act=O,this.out_act},backward:function backward(){var M=this.in_act,N=this.out_act,O=M.w.length;M.dw=J.zeros(O);for(var P=0;P<O;P++)this.dropped[P]||(M.dw[P]=N.dw[P])},getParamsAndGrads:function getParamsAndGrads(){return[]},toJSON:function toJSON(){var M={out_depth:this.out_depth,out_sx:this.out_sx,out_sy:this.out_sy,layer_type:this.layer_type,drop_prob:this.drop_prob};return M},fromJSON:function fromJSON(M){this.out_depth=M.out_depth,this.out_sx=M.out_sx,this.out_sy=M.out_sy,this.layer_type=M.layer_type,this.drop_prob=M.drop_prob}},J.DropoutLayer=L}(convnetjs),function(J){var K=J.Vol,L=function b(M){var M=M||{};this.k=M.k,this.n=M.n,this.alpha=M.alpha,this.beta=M.beta,this.out_sx=M.in_sx,this.out_sy=M.in_sy,this.out_depth=M.in_depth,this.layer_type="lrn",0==this.n%2&&console.log("WARNING n should be odd for LRN layer")};L.prototype={forward:function forward(M){this.in_act=M;var O=M.cloneAndZero();this.S_cache_=M.cloneAndZero();for(var P=_Mathfloor(this.n/2),Q=0;Q<M.sx;Q++)for(var R=0;R<M.sy;R++)for(var S=0;S<M.depth;S++){for(var W,T=M.get(Q,R,S),U=0,V=_Mathmax(0,S-P);V<=_Mathmin(S+P,M.depth-1);V++)W=M.get(Q,R,V),U+=W*W;U*=this.alpha/this.n,U+=this.k,this.S_cache_.set(Q,R,S,U),U=_Mathpow(U,this.beta),O.set(Q,R,S,T/U)}return this.out_act=O,this.out_act},backward:function backward(){var M=this.in_act;M.dw=J.zeros(M.w.length);for(var N=this.out_act,O=_Mathfloor(this.n/2),P=0;P<M.sx;P++)for(var Q=0;Q<M.sy;Q++)for(var R=0;R<M.depth;R++)for(var S=this.out_act.get_grad(P,Q,R),T=this.S_cache_.get(P,Q,R),U=_Mathpow(T,this.beta),W=_Mathmax(0,R-O);W<=_Mathmin(R+O,M.depth-1);W++){var X=M.get(P,Q,W),Y=2*(-X*this.beta*_Mathpow(T,this.beta-1)*this.alpha/this.n)*X;W===R&&(Y+=U),Y/=U*U,Y*=S,M.add_grad(P,Q,W,Y)}},getParamsAndGrads:function getParamsAndGrads(){return[]},toJSON:function toJSON(){var M={k:this.k,n:this.n,alpha:this.alpha,beta:this.beta,out_sx:this.out_sx,out_sy:this.out_sy,out_depth:this.out_depth,layer_type:this.layer_type};return M},fromJSON:function fromJSON(M){this.k=M.k,this.n=M.n,this.alpha=M.alpha,this.beta=M.beta,this.out_sx=M.out_sx,this.out_sy=M.out_sy,this.out_depth=M.out_depth,this.layer_type=M.layer_type}},J.LocalResponseNormalizationLayer=L}(convnetjs),function(J){var K=J.Vol,L=J.assert,M=function c(){this.layers=[]};M.prototype={makeLayers:function makeLayers(N){L(2<=N.length,"Error! At least one input layer and one loss layer are required."),L("input"===N[0].type,"Error! First layer must be the input layer, to declare size of inputs");N=function f(){for(var U,S=[],T=0;T<N.length;T++){if(U=N[T],("softmax"===U.type||"svm"===U.type)&&S.push({type:"fc",num_neurons:U.num_classes}),"regression"===U.type&&S.push({type:"fc",num_neurons:U.num_neurons}),("fc"===U.type||"conv"===U.type)&&"undefined"==typeof U.bias_pref&&(U.bias_pref=0,"undefined"!=typeof U.activation&&"relu"===U.activation&&(U.bias_pref=0.1)),S.push(U),"undefined"!=typeof U.activation)if("relu"===U.activation)S.push({type:"relu"});else if("sigmoid"===U.activation)S.push({type:"sigmoid"});else if("tanh"===U.activation)S.push({type:"tanh"});else if("maxout"===U.activation){var V="undefined"===U.group_size?2:U.group_size;S.push({type:"maxout",group_size:V})}else console.log("ERROR unsupported activation "+U.activation);"undefined"!=typeof U.drop_prob&&"dropout"!==U.type&&S.push({type:"dropout",drop_prob:U.drop_prob})}return S}(N),this.layers=[];for(var Q,P=0;P<N.length;P++){if(Q=N[P],0<P){var R=this.layers[P-1];Q.in_sx=R.out_sx,Q.in_sy=R.out_sy,Q.in_depth=R.out_depth}switch(Q.type){case"fc":this.layers.push(new J.FullyConnLayer(Q));break;case"lrn":this.layers.push(new J.LocalResponseNormalizationLayer(Q));break;case"dropout":this.layers.push(new J.DropoutLayer(Q));break;case"input":this.layers.push(new J.InputLayer(Q));break;case"softmax":this.layers.push(new J.SoftmaxLayer(Q));break;case"regression":this.layers.push(new J.RegressionLayer(Q));break;case"conv":this.layers.push(new J.ConvLayer(Q));break;case"pool":this.layers.push(new J.PoolLayer(Q));break;case"relu":this.layers.push(new J.ReluLayer(Q));break;case"sigmoid":this.layers.push(new J.SigmoidLayer(Q));break;case"tanh":this.layers.push(new J.TanhLayer(Q));break;case"maxout":this.layers.push(new J.MaxoutLayer(Q));break;case"svm":this.layers.push(new J.SVMLayer(Q));break;default:console.log("ERROR: UNRECOGNIZED LAYER TYPE: "+Q.type);}}},forward:function forward(N,O){"undefined"==typeof O&&(O=!1);for(var P=this.layers[0].forward(N,O),Q=1;Q<this.layers.length;Q++)P=this.layers[Q].forward(P,O);return P},getCostLoss:function getCostLoss(N,O){this.forward(N,!1);var P=this.layers.length,Q=this.layers[P-1].backward(O);return Q},backward:function backward(N){for(var O=this.layers.length,P=this.layers[O-1].backward(N),Q=O-2;0<=Q;Q--)this.layers[Q].backward();return P},getParamsAndGrads:function getParamsAndGrads(){for(var P,N=[],O=0;O<this.layers.length;O++){P=this.layers[O].getParamsAndGrads();for(var Q=0;Q<P.length;Q++)N.push(P[Q])}return N},getPrediction:function getPrediction(){var N=this.layers[this.layers.length-1];L("softmax"===N.layer_type,"getPrediction function assumes softmax as last layer of the net!");for(var O=N.out_act.w,P=O[0],Q=0,R=1;R<O.length;R++)O[R]>P&&(P=O[R],Q=R);return Q},toJSON:function toJSON(){for(var N={layers:[]},O=0;O<this.layers.length;O++)N.layers.push(this.layers[O].toJSON());return N},fromJSON:function fromJSON(N){this.layers=[];for(var O=0;O<N.layers.length;O++){var P=N.layers[O],Q=P.layer_type,R;"input"===Q&&(R=new J.InputLayer),"relu"===Q&&(R=new J.ReluLayer),"sigmoid"===Q&&(R=new J.SigmoidLayer),"tanh"===Q&&(R=new J.TanhLayer),"dropout"===Q&&(R=new J.DropoutLayer),"conv"===Q&&(R=new J.ConvLayer),"pool"===Q&&(R=new J.PoolLayer),"lrn"===Q&&(R=new J.LocalResponseNormalizationLayer),"softmax"===Q&&(R=new J.SoftmaxLayer),"regression"===Q&&(R=new J.RegressionLayer),"fc"===Q&&(R=new J.FullyConnLayer),"maxout"===Q&&(R=new J.MaxoutLayer),"svm"===Q&&(R=new J.SVMLayer),R.fromJSON(P),this.layers.push(R)}}},J.Net=M}(convnetjs),function(J){var K=J.Vol,L=function c(M,N){this.net=M;var N=N||{};this.learning_rate="undefined"==typeof N.learning_rate?0.01:N.learning_rate,this.l1_decay="undefined"==typeof N.l1_decay?0:N.l1_decay,this.l2_decay="undefined"==typeof N.l2_decay?0:N.l2_decay,this.batch_size="undefined"==typeof N.batch_size?1:N.batch_size,this.method="undefined"==typeof N.method?"sgd":N.method,this.momentum="undefined"==typeof N.momentum?0.9:N.momentum,this.ro="undefined"==typeof N.ro?0.95:N.ro,this.eps="undefined"==typeof N.eps?1e-6:N.eps,this.k=0,this.gsum=[],this.xsum=[]};L.prototype={train:function train(M,N){var O=new Date().getTime();this.net.forward(M,!0);var P=new Date().getTime(),O=new Date().getTime(),R=this.net.backward(N),S=0,T=0,P=new Date().getTime();if(this.k++,0==this.k%this.batch_size){var V=this.net.getParamsAndGrads();if(0===this.gsum.length&&("sgd"!==this.method||0<this.momentum))for(var W=0;W<V.length;W++)this.gsum.push(J.zeros(V[W].params.length)),"adadelta"===this.method?this.xsum.push(J.zeros(V[W].params.length)):this.xsum.push([]);for(var W=0;W<V.length;W++)for(var X=V[W],Y=X.params,Z=X.grads,$="undefined"==typeof X.l2_decay_mul?1:X.l2_decay_mul,_="undefined"==typeof X.l1_decay_mul?1:X.l1_decay_mul,aa=this.l2_decay*$,ba=this.l1_decay*_,ca=Y.length,da=0;da<ca;da++){S+=aa*Y[da]*Y[da]/2,T+=ba*Math.abs(Y[da]);var ea=ba*(0<Y[da]?1:-1),fa=aa*Y[da],ga=(fa+ea+Z[da])/this.batch_size,ha=this.gsum[W],ia=this.xsum[W];if("adagrad"===this.method){ha[da]+=ga*ga;var ja=-this.learning_rate/_Mathsqrt(ha[da]+this.eps)*ga;Y[da]+=ja}else if("windowgrad"===this.method){ha[da]=this.ro*ha[da]+(1-this.ro)*ga*ga;var ja=-this.learning_rate/_Mathsqrt(ha[da]+this.eps)*ga;Y[da]+=ja}else if("adadelta"===this.method){ha[da]=this.ro*ha[da]+(1-this.ro)*ga*ga;var ja=-_Mathsqrt((ia[da]+this.eps)/(ha[da]+this.eps))*ga;ia[da]=this.ro*ia[da]+(1-this.ro)*ja*ja,Y[da]+=ja}else if("nesterov"===this.method){var ja=ha[da];ha[da]=ha[da]*this.momentum+this.learning_rate*ga,ja=this.momentum*ja-(1+this.momentum)*ha[da],Y[da]+=ja}else if(0<this.momentum){var ja=this.momentum*ha[da]-this.learning_rate*ga;ha[da]=ja,Y[da]+=ja}else Y[da]+=-this.learning_rate*ga;Z[da]=0}}return{fwd_time:P-O,bwd_time:P-O,l2_decay_loss:S,l1_decay_loss:T,cost_loss:R,softmax_loss:R,loss:R+T+S}}},J.Trainer=L,J.SGDTrainer=L}(convnetjs),function(J){var K=J.randf,L=J.randi,M=J.Net,N=J.Trainer,O=J.maxmin,P=J.randperm,Q=J.weightedSample,R=J.getopt,S=J.arrUnique,T=function a(U,V,W){var W=W||{};"undefined"==typeof U&&(U=[]),"undefined"==typeof V&&(V=[]),this.data=U,this.labels=V,this.train_ratio=R(W,"train_ratio",0.7),this.num_folds=R(W,"num_folds",10),this.num_candidates=R(W,"num_candidates",50),this.num_epochs=R(W,"num_epochs",50),this.ensemble_size=R(W,"ensemble_size",10),this.batch_size_min=R(W,"batch_size_min",10),this.batch_size_max=R(W,"batch_size_max",300),this.l2_decay_min=R(W,"l2_decay_min",-4),this.l2_decay_max=R(W,"l2_decay_max",2),this.learning_rate_min=R(W,"learning_rate_min",-4),this.learning_rate_max=R(W,"learning_rate_max",0),this.momentum_min=R(W,"momentum_min",0.9),this.momentum_max=R(W,"momentum_max",0.9),this.neurons_min=R(W,"neurons_min",5),this.neurons_max=R(W,"neurons_max",30),this.folds=[],this.candidates=[],this.evaluated_candidates=[],this.unique_labels=S(V),this.iter=0,this.foldix=0,this.finish_fold_callback=null,this.finish_batch_callback=null,0<this.data.length&&(this.sampleFolds(),this.sampleCandidates())};T.prototype={sampleFolds:function sampleFolds(){var U=this.data.length,V=_Mathfloor(this.train_ratio*U);this.folds=[];for(var X,W=0;W<this.num_folds;W++)X=P(U),this.folds.push({train_ix:X.slice(0,V),test_ix:X.slice(V,U)})},sampleCandidate:function sampleCandidate(){var U=this.data[0].w.length,V=this.unique_labels.length,W=[];W.push({type:"input",out_sx:1,out_sy:1,out_depth:U});for(var X=Q([0,1,2,3],[0.2,0.3,0.3,0.2]),Y=0;Y<X;Y++){var Z=L(this.neurons_min,this.neurons_max),$=["tanh","maxout","relu"][L(0,3)];if(0.5>K(0,1)){var _=Math.random();W.push({type:"fc",num_neurons:Z,activation:$,drop_prob:_})}else W.push({type:"fc",num_neurons:Z,activation:$})}W.push({type:"softmax",num_classes:V});var aa=new M;aa.makeLayers(W);var ga,ba=L(this.batch_size_min,this.batch_size_max),ca=_Mathpow(10,K(this.l2_decay_min,this.l2_decay_max)),da=_Mathpow(10,K(this.learning_rate_min,this.learning_rate_max)),ea=K(this.momentum_min,this.momentum_max),fa=K(0,1);ga=0.33>fa?{method:"adadelta",batch_size:ba,l2_decay:ca}:0.66>fa?{method:"adagrad",learning_rate:da,batch_size:ba,l2_decay:ca}:{method:"sgd",learning_rate:da,momentum:ea,batch_size:ba,l2_decay:ca};var ha=new N(aa,ga),ia={};return ia.acc=[],ia.accv=0,ia.layer_defs=W,ia.trainer_def=ga,ia.net=aa,ia.trainer=ha,ia},sampleCandidates:function sampleCandidates(){this.candidates=[];for(var V,U=0;U<this.num_candidates;U++)V=this.sampleCandidate(),this.candidates.push(V)},step:function step(){this.iter++;for(var U=this.folds[this.foldix],V=U.train_ix[L(0,U.train_ix.length)],W=0;W<this.candidates.length;W++){var X=this.data[V],Y=this.labels[V];this.candidates[W].trainer.train(X,Y)}var Z=this.num_epochs*U.train_ix.length;if(this.iter>=Z){for(var _,$=this.evalValErrors(),W=0;W<this.candidates.length;W++)_=this.candidates[W],_.acc.push($[W]),_.accv+=$[W];if(this.iter=0,this.foldix++,null!==this.finish_fold_callback&&this.finish_fold_callback(),this.foldix>=this.folds.length){for(var W=0;W<this.candidates.length;W++)this.evaluated_candidates.push(this.candidates[W]);this.evaluated_candidates.sort(function(ca,da){return ca.accv/ca.acc.length>da.accv/da.acc.length?-1:1}),this.evaluated_candidates.length>3*this.ensemble_size&&(this.evaluated_candidates=this.evaluated_candidates.slice(0,3*this.ensemble_size)),null!==this.finish_batch_callback&&this.finish_batch_callback(),this.sampleCandidates(),this.foldix=0}else for(var W=0;W<this.candidates.length;W++){var _=this.candidates[W],aa=new M;aa.makeLayers(_.layer_defs);var ba=new N(aa,_.trainer_def);_.net=aa,_.trainer=ba}}},evalValErrors:function evalValErrors(){for(var U=[],V=this.folds[this.foldix],W=0;W<this.candidates.length;W++){for(var X=this.candidates[W].net,Y=0,Z=0;Z<V.test_ix.length;Z++){var $=this.data[V.test_ix[Z]],_=this.labels[V.test_ix[Z]];X.forward($);var aa=X.getPrediction();Y+=aa===_?1:0}Y/=V.test_ix.length,U.push(Y)}return U},predict_soft:function predict_soft(U){var V=[],W=0;0===this.evaluated_candidates.length?(W=this.candidates.length,V=this.candidates):(W=_Mathmin(this.ensemble_size,this.evaluated_candidates.length),V=this.evaluated_candidates);for(var X,Y,Z=0;Z<W;Z++){var $=V[Z].net,_=$.forward(U);if(0===Z)X=_,Y=_.w.length;else for(var aa=0;aa<Y;aa++)X.w[aa]+=_.w[aa]}for(var aa=0;aa<Y;aa++)X.w[aa]/=W;return X},predict:function predict(U){var V=this.predict_soft(U);if(0!==V.w.length)var W=O(V.w),X=W.maxi;else var X=-1;return X},toJSON:function toJSON(){var U=_Mathmin(this.ensemble_size,this.evaluated_candidates.length),V={};V.nets=[];for(var W=0;W<U;W++)V.nets.push(this.evaluated_candidates[W].net.toJSON());return V},fromJSON:function fromJSON(U){this.ensemble_size=U.nets.length,this.evaluated_candidates=[];for(var W,V=0;V<this.ensemble_size;V++){W=new M,W.fromJSON(U.nets[V]);var X={};X.net=W,this.evaluated_candidates.push(X)}},onFinishFold:function onFinishFold(U){this.finish_fold_callback=U},onFinishBatch:function onFinishBatch(U){this.finish_batch_callback=U}},J.MagicNet=T}(convnetjs),function(J){"undefined"==typeof module||"undefined"==typeof module.exports?window.jsfeat=J:module.exports=J}(convnetjs);

},{}],2:[function(require,module,exports){
'use strict';var _createClass=function(){function a(b,c){for(var e,d=0;d<c.length;d++)e=c[d],e.enumerable=e.enumerable||!1,e.configurable=!0,'value'in e&&(e.writable=!0),Object.defineProperty(b,e.key,e)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_const=require(4);Object.defineProperty(exports,'__esModule',{value:!0}),exports.GLDrawer=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a}function _inherits(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var GLDrawer=exports.GLDrawer=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return _inherits(b,a),_createClass(b,[{key:'viewportResize',value:function viewportResize(){}},{key:'type',get:function get(){return _const.ANIMATION_NONE}}]),b}(Flip.GL.Stage);

},{"4":4}],3:[function(require,module,exports){
'use strict';var _createClass=function(){function a(b,c){for(var f,d=0;d<c.length;d++)f=c[d],f.enumerable=f.enumerable||!1,f.configurable=!0,'value'in f&&(f.writable=!0),Object.defineProperty(b,f.key,f)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_get=function a(b,c,d){null===b&&(b=Function.prototype);var f=Object.getOwnPropertyDescriptor(b,c);if(f===void 0){var g=Object.getPrototypeOf(b);return null===g?void 0:a(g,c,d)}if('value'in f)return f.value;var h=f.get;return void 0===h?void 0:h.call(d)},_viewport=require(17);Object.defineProperty(exports,'__esModule',{value:!0}),exports.GLRenderPipeline=exports.CANVAS_DISPLAY_MODE_FULL_CONTENT_SCROLL=exports.CANVAS_DISPLAY_MODE_ORIGIN=exports.CANVAS_DISPLAY_MODE_FULL_SCREEN=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a}function _inherits(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var CANVAS_DISPLAY_MODE_FULL_SCREEN=exports.CANVAS_DISPLAY_MODE_FULL_SCREEN='full-screen',CANVAS_DISPLAY_MODE_ORIGIN=exports.CANVAS_DISPLAY_MODE_ORIGIN='origin',CANVAS_DISPLAY_MODE_FULL_CONTENT_SCROLL=exports.CANVAS_DISPLAY_MODE_FULL_CONTENT_SCROLL='full-scroll',GLRenderPipeline=exports.GLRenderPipeline=function(a){function b(c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c));return d.dpi=c.dpi||_viewport.defaultDPI,d.canvas=c.canvas,d.viewport=d.getCanvasViewport(),d.canvasDisplayMode=c.display||CANVAS_DISPLAY_MODE_FULL_SCREEN,d.drawers=[],d}return _inherits(b,a),_createClass(b,[{key:'init',value:function init(c){_get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),'init',this).call(this,c)}},{key:'addDrawer',value:function addDrawer(c){return this.add(c)&&(c.parentPipeline=this,this.drawers.push(c),c.viewportResize(this.viewport)),this}},{key:'update',value:function update(c){if(!this.disabled){_get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),'update',this).call(this,c);var d=this.getCanvasParentViewport();(0,_viewport.viewportEquals)(this.parentViewport,d)||(this.alignCanvas(),this.parentViewport=d);var f=this.getCanvasViewport();(0,_viewport.viewportEquals)(this.viewport,f)||this.onViewportResize(f,c.gl),this.drawers.forEach(function(g){return!g.disabled&&g.update(c)})}}},{key:'onViewportResize',value:function onViewportResize(c,d){this.viewport=c,d&&d.viewport(0,0,c.width,c.height),this.drawers.forEach(function(f){f.viewportResize(c),f.invalid()})}},{key:'getCanvasParentViewport',value:function getCanvasParentViewport(){var c=this.canvas.parentElement;if(c){var d=this.canvasDisplayMode==CANVAS_DISPLAY_MODE_FULL_CONTENT_SCROLL,f=d?c.scrollWidth:c.clientWidth,g=d?c.scrollHeight:c.clientHeight;return(0,_viewport.createViewport)(f,g,this.dpi)}return(0,_viewport.createViewport)(0,0,this.dpi)}},{key:'alignCanvas',value:function alignCanvas(){var c=this.canvasDisplayMode==CANVAS_DISPLAY_MODE_FULL_CONTENT_SCROLL;(this.canvasDisplayMode==CANVAS_DISPLAY_MODE_FULL_SCREEN||c)&&(0,_viewport.alignCanvas)(this.canvas,{extendScroll:c})}},{key:'getCanvasViewport',value:function getCanvasViewport(){var c=this.canvas;return(0,_viewport.createViewport)(c.width,c.height,this.dpi)}}]),b}(Flip.GL.Task);

},{"17":17}],4:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ANIMATION_NONE=exports.ANIMATION_NONE=0,ANIMATION_SNOW=exports.ANIMATION_SNOW=1,ANIMATION_STAR=exports.ANIMATION_STAR=2,ANIMATION_MOON=exports.ANIMATION_MOON=4,ANIMATION_SUN=exports.ANIMATION_SUN=8,ANIMATION_RAIN=exports.ANIMATION_RAIN=16;

},{}],5:[function(require,module,exports){
'use strict';var _createClass=function(){function a(b,c){for(var f,d=0;d<c.length;d++)f=c[d],f.enumerable=f.enumerable||!1,f.configurable=!0,'value'in f&&(f.writable=!0),Object.defineProperty(b,f.key,f)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_get=function a(b,c,d){null===b&&(b=Function.prototype);var f=Object.getOwnPropertyDescriptor(b,c);if(f===void 0){var g=Object.getPrototypeOf(b);return null===g?void 0:a(g,c,d)}if('value'in f)return f.value;var h=f.get;return void 0===h?void 0:h.call(d)};Object.defineProperty(exports,'__esModule',{value:!0});function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a}function _inherits(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var DEF_VERTEX_SHADER=function(a){return'\nprecision mediump float;\n\nattribute vec2 aQuad;\nvarying vec2 '+a+';\nuniform bool uFlipXCoord;\nuniform mat3 uFilterRegionTransform;\n\nvoid main(){\n   vec3 pos = uFilterRegionTransform * vec3(aQuad,1.0);\n   vec2 texIndex = pos.xy /2. +.5;\n   if(uFlipXCoord)\n    texIndex.x = 1. - texIndex.x;\n   '+a+' = texIndex;\n   gl_Position = vec4(pos.xy,0.0,1.0);\n}\n'},DEF_FRAGMENT_SHADER=function(a,b){return'\nprecision mediump float;\n\nvarying vec2 '+a+';\n\n'+b+'\n'},COPY_PROGRAM='\nuniform sampler2D uSampler;\n\nvoid main(){\n  gl_FragColor = texture2D(uSampler,vTexIndex);\n}\n',GLFilter=exports.GLFilter=function(a){function b(c){_classCallCheck(this,b);var d=c.texCoordName||'vTexIndex',f=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,{vertexShader:DEF_VERTEX_SHADER(d),fragShader:DEF_FRAGMENT_SHADER(d,c.program||COPY_PROGRAM),define:c.define,name:c.name}));f.addBinder(f.buildBinder(c.binder)),f.addBinder(f.buildBinder({aQuad:[-1,-1,1,-1,-1,1,1,1],uFlipXCoord:!1,uFilterRegionTransform:new Flip.Mat3,uSampler:null}));var g;return g=c.framebuffer instanceof Flip.GL.FrameBuffer?c.framebuffer:new Flip.GL.FrameBuffer(c.framebuffer||{name:'filter-fbo'}),f.fbo=g,f.createMeshes(c).forEach(function(h){h instanceof Flip.GL.Mesh||(h=new Flip.GL.Mesh(Object.assign(h,{drawCount:4,primitive:Flip.GL.TRIANGLE_STRIP}))),f.add(h)}),f}return _inherits(b,a),_createClass(b,[{key:'transformFilterRegion',value:function transformFilterRegion(c){this.binder.uFilterRegionTransform.value=c.clone(),this.invalid()}},{key:'createMeshes',value:function createMeshes(){return[{}]}},{key:'setSource',value:function setSource(c,d,f){var g=this.binder[d];g.data=c,g.dynamicSource=f,this.invalid()}},{key:'getTargetFBOOwner',value:function getTargetFBOOwner(){return this}},{key:'setTarget',value:function setTarget(c,d){var f=this.fbo;this.target&&this.target.removeBinder(this._targetBinder),d||(d='uSampler');var g=this._targetBinder=f.createSampler2D(d,!1);g.name=d,this.target=c;var h=this.getTargetFBOOwner();c?h.addBinder(f):h.removeBinder(f),c.removeBinder(d),c.addBinder(g)}},{key:'dispose',value:function dispose(c){_get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),'dispose',this).call(this,c),this.fbo.dispose(c)}},{key:'sourceBinder',get:function get(){return this.binder.uSampler}},{key:'source',set:function set(c){var d=this.sourceBinder;d.source=c;var f=c instanceof HTMLVideoElement;d.dynamicSource=f,this.binder.uFlipXCoord.value=f}}]),b}(Flip.GL.Scene);

},{}],6:[function(require,module,exports){
'use strict';var _createClass=function(){function a(b,c){for(var f,d=0;d<c.length;d++)f=c[d],f.enumerable=f.enumerable||!1,f.configurable=!0,'value'in f&&(f.writable=!0),Object.defineProperty(b,f.key,f)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_GLFilter2=require(5);Object.defineProperty(exports,'__esModule',{value:!0}),exports.MirrorFilter=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a}function _inherits(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var FRAG_SHADER='\nuniform sampler2D uSampler;\nuniform float uAlpha;\nvoid main(){\n  vec3 color = texture2D(uSampler,vTexIndex).rgb;\n  vec2 pos =(vTexIndex - .5) * 2.;\n  float len =length(pos);\n  \n  float a = uAlpha * (1.-smoothstep(0.3,1.0,len));\n  gl_FragColor = vec4(color,a);\n}\n',MirrorFilter=exports.MirrorFilter=function(a){function b(c){_classCallCheck(this,b),c.program=FRAG_SHADER;var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c));return d.addBinder(d.buildBinder({uAlpha:isNaN(c.alpha)?0.5:c.alpha,blend:function blend(f){f.enable(f.BLEND),f.blendFunc(f.SRC_ALPHA,f.ONE_MINUS_SRC_ALPHA)}})),d}return _inherits(b,a),_createClass(b,[{key:'alpha',get:function get(){return this.binder.uAlpha.value},set:function set(c){this.alpha!=c&&(this.binder.uAlpha.value=+c,this.invalid())}}]),b}(_GLFilter2.GLFilter);

},{"5":5}],7:[function(require,module,exports){
'use strict';var _createClass=function(){function a(b,c){for(var e,d=0;d<c.length;d++)e=c[d],e.enumerable=e.enumerable||!1,e.configurable=!0,'value'in e&&(e.writable=!0),Object.defineProperty(b,e.key,e)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_GLFilter2=require(5),_shader=require(9),shader=_interopRequireWildcard(_shader);Object.defineProperty(exports,'__esModule',{value:!0}),exports.OpeningFilter=void 0;function _interopRequireWildcard(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a}function _inherits(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var OpeningFilter=exports.OpeningFilter=function(a){function b(c){_classCallCheck(this,b),c.program=shader.MORPHOLOGICAL_FRAG_SHADER(c.window||3);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c));return d.addBinder(d.buildBinder({uTexSize:[0,0]})),d}return _inherits(b,a),_createClass(b,[{key:'getTargetFBOOwner',value:function getTargetFBOOwner(){return this.children[1]}},{key:'createMeshes',value:function createMeshes(){var d=new Flip.GL.FrameBuffer({name:'fbo'});return[{binder:this.buildBinder({uProcess:shader.MORPHOLOGICAL_PROCESS_EROSION,framebuffer:d})},{binder:this.buildBinder({uProcess:shader.MORPHOLOGICAL_PROCESS_DILATION,uSampler:d.createSampler2D('uSampler')})}]}},{key:'size',set:function set(c){this.binder.uTexSize.value=c,this.invalid()}},{key:'input',set:function set(c){var d=this.binder.uSampler;d.source=c,d.dynamicSource=c instanceof HTMLVideoElement,this.invalid()}}]),b}(_GLFilter2.GLFilter);

},{"5":5,"9":9}],8:[function(require,module,exports){
'use strict';var _createClass=function(){function a(b,c){for(var e,d=0;d<c.length;d++)e=c[d],e.enumerable=e.enumerable||!1,e.configurable=!0,'value'in e&&(e.writable=!0),Object.defineProperty(b,e.key,e)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_GLFilter2=require(5);Object.defineProperty(exports,'__esModule',{value:!0}),exports.EDGE_FRAG_SHADER=exports.SobelEdgeFilter=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a}function _inherits(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var SobelEdgeFilter=exports.SobelEdgeFilter=function(a){function b(c){_classCallCheck(this,b),c.program=EDGE_FRAG_SHADER;var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c));return d.addBinder(d.buildBinder({uEdgeScale:c.threshold||3,uTexSize:[0,0]})),d}return _inherits(b,a),_createClass(b,[{key:'size',set:function set(c){this.binder.uTexSize.value=c}}]),b}(_GLFilter2.GLFilter),EDGE_FRAG_SHADER=exports.EDGE_FRAG_SHADER='\n  \n  uniform vec2 uTexSize;\n  uniform float uEdgeScale;\n  uniform sampler2D uSampler;\n  \n  void main(){\n    vec2 texInc = 1./uTexSize;\n    vec3 ret=vec3(0.0);\n    #define texLum(x,y) texture2D(uSampler,vec2(x,y) * texInc + vTexIndex).rgb\n    vec3 t = texLum(0.,-1.);\n    vec3 b = texLum(0.,1.);\n    vec3 l = texLum(-1.,0.);\n    vec3 r = texLum(1.,0.);\n    vec3 lt = texLum(-1.,-1.);\n    vec3 lb = texLum(-1.,1.);\n    vec3 rt = texLum(1.,-1.);\n    vec3 rb = texLum(1.,1.);\n    vec3 h = lt + 2.* t + rt - lb - 2.* b - rb;\n    vec3 v = lt + 2.* l + lb - rt - 2.* r - rb;\n    float lum =any(greaterThan((abs(v)+abs(h)),vec3(0.5 * uEdgeScale))) ? 1.:0.;\n    \n    gl_FragColor = vec4(vec3(lum),1.0);\n  }\n  \n';

},{"5":5}],9:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MORPHOLOGICAL_PROCESS_EROSION=exports.MORPHOLOGICAL_PROCESS_EROSION=1,MORPHOLOGICAL_PROCESS_DILATION=exports.MORPHOLOGICAL_PROCESS_DILATION=2,MORPHOLOGICAL_FRAG_SHADER=exports.MORPHOLOGICAL_FRAG_SHADER=function(a){return"\n  const int PROCESS_EROSION ="+MORPHOLOGICAL_PROCESS_EROSION+";\n  const int PROCESS_DILATION = "+MORPHOLOGICAL_PROCESS_DILATION+";\n  \n  const int _ws = "+-parseInt((a-1)/2)+";\n  const int _we = "+parseInt((a-1)/2)+";\n  uniform sampler2D uSampler;\n  uniform vec2 uTexSize;\n  uniform int uProcess;\n  \n  vec3 erosion(sampler2D tex,vec2 index,vec2 inc);\n  vec3 dilation(sampler2D tex,vec2 index,vec2 inc);\n  \n  void main(){\n    vec3 ret= vec3(0.0);\n    float a =1.;\n    if(uProcess == PROCESS_EROSION){\n      ret = erosion(uSampler,vTexIndex,1./uTexSize);\n    }\n    else if(uProcess == PROCESS_DILATION){\n      ret = dilation(uSampler,vTexIndex,1./uTexSize);\n    }\n    else{\n      ret = texture2D(uSampler,vTexIndex).rgb;\n    }\n    gl_FragColor = vec4(ret,1.0);\n  }\n  \n  #define t(a,b) texture2D(tex,index + vec2(a,b) * inc).rgb\n  vec3 erosion(sampler2D tex,vec2 index,vec2 inc){\n    vec3 _zero = vec3(0.0);\n    for(int x = _ws;x <= _we;x++){\n      for(int y= _ws;y <= _we;y++){\n        vec3 c = t(float(x),float(y));\n        if(any(equal(c,_zero))){\n          return vec3(0.0);\n        }\n      }\n    }\n    return vec3(1.0);\n  }\n  vec3 dilation(sampler2D tex,vec2 index,vec2 inc){\n    vec3 _zero = vec3(0.0);\n    for(int x = _ws;x <= _we;x++){\n      for(int y= _ws;y <= _we;y++){\n        vec3 c = t(float(x),float(y));\n        if(any(greaterThan(c,_zero))){\n          return vec3(1.0);\n        }\n      }\n    }\n    return vec3(0.0);\n  }\n"};

},{}],10:[function(require,module,exports){
'use strict';var _slicedToArray=function(){function a(b,c){var d=[],e=!0,f=!1,g=void 0;try{for(var j,h=b[Symbol.iterator]();!(e=(j=h.next()).done)&&(d.push(j.value),!(c&&d.length===c));e=!0);}catch(l){f=!0,g=l}finally{try{!e&&h['return']&&h['return']()}finally{if(f)throw g}}return d}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError('Invalid attempt to destructure non-iterable instance')}}(),_createClass=function(){function a(b,c){for(var e,d=0;d<c.length;d++)e=c[d],e.enumerable=e.enumerable||!1,e.configurable=!0,'value'in e&&(e.writable=!0),Object.defineProperty(b,e.key,e)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&'function'==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?'symbol':typeof a};Object.defineProperty(exports,'__esModule',{value:!0});function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var convnetjs=exports.convnetjs='object'==('undefined'==typeof window?'undefined':_typeof(window))&&window.convnetjs?window.convnetjs:require(1),Vol=exports.Vol=convnetjs.Vol,NeuralNet=exports.NeuralNet=function(){function a(b){_classCallCheck(this,a);var c=this.net=new convnetjs.Net;if(this.trainer=new convnetjs.SGDTrainer(c,{method:'adadelta',batch_size:20,l2_decay:1e-3}),b.json)this.loadJSON(b.json);else{var d=[];this.volSize=[b.sampleWidth,b.sampleHeight],d.push({type:'input',out_sx:b.sampleWidth,out_sy:b.sampleHeight,out_depth:1}),d.push({type:'conv',sx:5,filters:8,stride:1,pad:2,activation:'relu'}),d.push({type:'pool',sx:2,stride:2}),d.push({type:'conv',sx:5,filters:16,stride:1,pad:2,activation:'relu'}),d.push({type:'pool',sx:3,stride:3}),d.push({type:'softmax',num_classes:b.classesCount||2}),c.makeLayers(d)}}return _createClass(a,[{key:'train',value:function train(b,c){if(!(b instanceof Vol)||b.sx!=this.volSize[0]||b.sy!=this.volSize[1])throw Error('invalid Vol');this.trainer.train(b,c)}},{key:'createVolFromImageData',value:function createVolFromImageData(b){for(var c=_slicedToArray(this.volSize,2),d=c[0],e=c[1],f=new convnetjs.Vol(d,e,1,0),g=b.data,h=f.w,j=0,l=0,m=0;j<e;j++){l=4*(j*b.width);for(var n=0;n<d;n++)h[m++]=g[l]/255,l+=4}return f}},{key:'toJSON',value:function toJSON(){var b=this.net.toJSON();return JSON.stringify(b,function(c,d){return d&&d.buffer instanceof ArrayBuffer?Array.from(d):d})}},{key:'loadJSON',value:function loadJSON(b){var c=b;'string'==typeof b&&(c=JSON.parse(b));var d=this.net=new convnetjs.Net;d.fromJSON(c),this.trainer.net=d;var e=d.layers[0];this.volSize=[+e.out_sx,+e.out_sy]}},{key:'predict',value:function predict(b){if(!(b instanceof Vol)||b.sx!=this.volSize[0]||b.sy!=this.volSize[1])throw Error('invalid Vol');return this.net.forward(b)}}]),a}();

},{"1":1}],11:[function(require,module,exports){
'use strict';var _slicedToArray=function(){function a(b,c){var d=[],e=!0,f=!1,g=void 0;try{for(var k,h=b[Symbol.iterator]();!(e=(k=h.next()).done)&&(d.push(k.value),!(c&&d.length===c));e=!0);}catch(l){f=!0,g=l}finally{try{!e&&h['return']&&h['return']()}finally{if(f)throw g}}return d}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError('Invalid attempt to destructure non-iterable instance')}}(),_typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&'function'==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?'symbol':typeof a},_createClass=function(){function a(b,c){for(var e,d=0;d<c.length;d++)e=c[d],e.enumerable=e.enumerable||!1,e.configurable=!0,'value'in e&&(e.writable=!0),Object.defineProperty(b,e.key,e)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_math=require(15);var _MathPI=Math.PI;Object.defineProperty(exports,'__esModule',{value:!0}),exports.ImageSampler=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var _canvas=document.createElement('canvas'),_ctx=_canvas.getContext('2d'),ImageSampler=exports.ImageSampler=function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:'imageFromDataAsync',value:function imageFromDataAsync(b){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return resetCanvas(_canvas,b),_ctx.putImageData(b,0,0),new Promise(function(d,e){var f=new Image;f.src=_canvas.toDataURL(c.format||'image/jpeg',c.compress||0.7),f.onload=function(){return d(f)},f.onerror=e})}},{key:'trainNet',value:function trainNet(b,c,d){function e(){if(f<k&&g<l){var o=[];h.forEach(function(q,r){var s=q[f];o[r]=n.sampleImage(s,m)});for(var q=0;q<l;q++)for(var s,r=0;r<o.length;r++)s=o[r][q],b.train(b.createVolFromImageData(s),r);g++;var p=(f+g/l)/k;g>=l&&(g=0,f++),d(p,!1),1>=p&&requestAnimationFrame(e)}}var f=0,g=0,h=c.images.map(function(o){return o.slice()}),k=h[0].length,l=c.count,m={count:60,rotate:c.rotate||[-_MathPI/10,_MathPI/10],scale:c.scale||[0.8,1.2],translate:c.translate||[-10,10]};if(h.some(function(o){return o.length!=k}))throw Error('the size of every image class train set should be same,but got:'+h.map(function(o){return o.length}).join(','));var n=this;'function'===('undefined'!=typeof d&&!_typeof(d))&&(d=noop),e()}},{key:'sampleImage',value:function sampleImage(b,c){var d=[],e=b.naturalWidth,f=b.naturalHeight;resetCanvas(_canvas,{width:e,height:f});for(var g=_slicedToArray(c.scale,2),h=g[0],k=g[1],l=_slicedToArray(c.translate,2),m=l[0],n=l[1],o=_slicedToArray(c.rotate,2),p=o[0],q=o[1],r=0;r<c.count;r++){_ctx.save(),_ctx.fillStyle='#000',_ctx.fillRect(0,0,e,f),_ctx.translate((0,_math.random)(m,n),(0,_math.random)(m,n)),_ctx.rotate((0,_math.random)(p,q));var s=(0,_math.random)(h,k);_ctx.scale(s,s),_ctx.drawImage(b,0,0,e,f),d.push(_ctx.getImageData(0,0,e,f)),_ctx.restore()}return d}}]),a}();function noop(){}function resetCanvas(a,b){var c=b.width,d=b.height;a.width=c,a.height=d}

},{"15":15}],12:[function(require,module,exports){
'use strict';var _createClass=function(){function a(b,c){for(var f,d=0;d<c.length;d++)f=c[d],f.enumerable=f.enumerable||!1,f.configurable=!0,'value'in f&&(f.writable=!0),Object.defineProperty(b,f.key,f)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_OpeningFilter=require(7),_SobelEdgeFilter=require(8),_GLFilter=require(5),_MirrorFilter=require(6),_GLDrawer2=require(2);Object.defineProperty(exports,'__esModule',{value:!0}),exports.VideoStage=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a}function _inherits(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var VideoStage=exports.VideoStage=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return _inherits(b,a),_createClass(b,[{key:'createScenes',value:function createScenes(c){var d=this,f=new _SobelEdgeFilter.SobelEdgeFilter({name:'edge',threshold:0.5}),g=new _OpeningFilter.OpeningFilter({name:'process'}),h=c.debug?new _GLFilter.GLFilter({name:'origin'}):new _MirrorFilter.MirrorFilter({name:'origin'});f.setTarget(g);var j=new Flip.GL.Mesh({});return j.render=function(k){return d.delegate&&d.delegate.processFrameEnd(d,k.gl)},g.add(j),this.delegate=c.delegate,[h,f,g]}},{key:'captureFrame',value:function captureFrame(c,d){d=d||this.processFrame;var f=parseInt(c.drawingBufferWidth*(d.x/2+.5)),g=parseInt(c.drawingBufferHeight*(d.y/2+.5)),h=d.size,j=h/2,k=new Uint8Array(4*(h*h));return c.readPixels(f-j,g-j,h,h,c.RGBA,c.UNSIGNED_BYTE,k),new ImageData(new Uint8ClampedArray(k),h,h)}},{key:'processFrame',get:function get(){return this._processFrame},set:function set(c){var d=this._size,f=new Flip.Mat3;d&&c&&f.translate(c.x,c.y).scale(c.size/d[0],c.size/d[1]),this.getScene('edge').transformFilterRegion(f),this.getScene('process').transformFilterRegion(f),this._processFrame=c}},{key:'source',set:function set(c){this.getScene('edge').source=c,this.getScene('origin').source=c}},{key:'size',set:function set(c){var d=[+c[0],+c[1]];this.getScene('edge').size=d,this.getScene('process').size=d,this._size=d,this.processFrame=this.processFrame}}]),b}(_GLDrawer2.GLDrawer);

},{"2":2,"5":5,"6":6,"7":7,"8":8}],13:[function(require,module,exports){
'use strict';var _webrtc=require(18),_setup=require(16),_VideoStage=require(12),_ImageSampler=require(11),_dom=require(14),_NeuralNet=require(10),stage=new _VideoStage.VideoStage({debug:!0}),sampler=new _ImageSampler.ImageSampler,processFrame={x:0,y:-.6,size:64},net=new _NeuralNet.NeuralNet({classesCount:5,sampleHeight:processFrame.size,sampleWidth:processFrame.size});(0,_webrtc.getCameraVideoOfSizeAsync)().then(function(a){var b=a.video,c=a.size;stage.source=b,stage.size=c,stage.processFrame=processFrame,stage.delegate=createCaptureDelegate((0,_dom.$)('#capture-cvs')),(0,_setup.setGLCanvasSize)(c[0],c[1]),(0,_setup.init)({drawers:[stage]}),initUI()});function createCaptureDelegate(){var b=[],c=[];return{processFrameEnd:function processFrameEnd(d,f){if(b.length+c.length){var g=d.captureFrame(f);c.forEach(function(h){return h(g)}),b.length&&sampler.imageFromDataAsync(g).then(function(h){b.forEach(function(i){return i(h)}),b=[]})}},onFrame:function onFrame(d){c.push(d)},captureImageAsync:function captureImageAsync(){return new Promise(function(d){return b.push(d)})}}}function initUI(){var a=['none','snow','rain','sun','moon'],b=(0,_dom.$)('select');b.innerHTML=a.map(function(f){return'<option value="'+f+'">'+f+'</option>'}).join('');var c=(0,_dom.$)('.samples'),d=!1;c.innerHTML=a.map(function(f){return'<div data-type="'+f+'"><p>'+f+':</p></div>'}).join(''),(0,_dom.$)('button.capture').onclick=function(){return stage.delegate.captureImageAsync().then(function(f){c.children[b.selectedIndex].appendChild(f)})},(0,_dom.$)('button.remove').onclick=function(){return(0,_dom.$$)('img.select',c).forEach(_dom.removeNodeFromParent)},(0,_dom.$)('button.train').onclick=function(){var f=[];(0,_dom.$$)('.samples [data-type]').forEach(function(g){return f.push((0,_dom.$$)('img',g))}),sampler.trainNet(net,{count:3,images:f},function(g){(0,_dom.$)('.train-progress').textContent=parseInt(100*g)+'%',console.log(g)})},(0,_dom.$)('button.test').onclick=function(){if(!d){d=!0;var f=(0,_dom.$)('.test-result');(0,_dom.toggleClass)(f,'hide',!1),stage.delegate.onFrame(function(g){var h=Array.from(net.predict(net.createVolFromImageData(g)).w),i=Math.max.apply(Math,h);f.textContent='may be '+a[h.indexOf(i)]+':'+h.map(function(j){return j.toFixed(2)}).join(',')})}},(0,_dom.$)('button.save').onclick=function(){var f=(0,_dom.$)('input.save');(0,_dom.toggleClass)(f,'hide',!1),f.value=net.toJSON()},c.onclick=function(f){return'IMG'==f.target.tagName&&(0,_dom.toggleClass)(f.target,'select')}}function drawSamples(a,b,c){var d=c.row,f=c.col,g=c.width,h=c.height,i=a.getContext('2d');a.height=h*d,a.width=g*f;for(var j=0,k=0;j<d;j++)for(var l=0;l<f;l++,k++)i.putImageData(b[k],l*g,j*h)}

},{"10":10,"11":11,"12":12,"14":14,"16":16,"18":18}],14:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:!0}),exports.$=$,exports.$e=$e,exports.$$e=$$e,exports._$=_$,exports._$$=_$$,exports.$$=$$,exports.toggleClass=toggleClass,exports.removeNodeFromParent=removeNodeFromParent;var slice=Array.prototype.slice,_div=document.createElement('div');function $(a,b){return a instanceof HTMLElement?a:(b||document).querySelector(a)}function $e(a){if(a instanceof HTMLElement)return a.cloneNode(!0);_div.innerHTML=a;var b=_div.children[0];return _div.innerHTML='',removeNodeFromParent(b),b}function $$e(a){_div.innerHTML=a;var b=slice.call(_div.children);return b.forEach(removeNodeFromParent),_div.innerHTML='',b}function _$(a,b){return(b||document).shadowRoot.querySelector(a)}function _$$(a,b){return slice.call((b||document).shadowRoot.querySelectorAll(a))}function $$(a,b){return slice.call((b||document).querySelectorAll(a))}function toggleClass(a,b,c){var d=2==arguments.length?a.classList.contains(b):!c;a.classList[d?'remove':'add'](b)}function removeNodeFromParent(a){return a&&a.parentNode&&(a.parentNode.removeChild(a),!0)}

},{}],15:[function(require,module,exports){
"use strict";var _Mathsin=Math.sin,_Mathcos=Math.cos;Object.defineProperty(exports,"__esModule",{value:!0}),exports.random=random,exports.parseSqrt=parseSqrt,exports.mapRange=mapRange,exports.vec3RotateX=vec3RotateX,exports.vec3RotateY=vec3RotateY;function random(d,e,f){var g=Math.random();return f&&(g=f(g)),g*(e-d)+d}function parseSqrt(d){var e=Math.sqrt(d),f=Math.ceil(e),g=Math.floor(e);return f*g>=d?[f,g]:[f,g+1]}function mapRange(d,e,f){return d+(e-d)*f}function vec3RotateX(d,e,f){var g=[],h=[],i=[];return g[0]=d[0]-e[0],g[1]=d[1]-e[1],g[2]=d[2]-e[2],h[0]=g[0],h[1]=g[1]*_Mathcos(f)-g[2]*_Mathsin(f),h[2]=g[1]*_Mathsin(f)+g[2]*_Mathcos(f),i[0]=h[0]+e[0],i[1]=h[1]+e[1],i[2]=h[2]+e[2],i}function vec3RotateY(d,e,f){var g=[],h=[],i=[];return g[0]=d[0]-e[0],g[1]=d[1]-e[1],g[2]=d[2]-e[2],h[0]=g[2]*_Mathsin(f)+g[0]*_Mathcos(f),h[1]=g[1],h[2]=g[2]*_Mathcos(f)-g[0]*_Mathsin(f),i[0]=h[0]+e[0],i[1]=h[1]+e[1],i[2]=h[2]+e[2],i}

},{}],16:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:!0}),exports.init=init,exports.setGLCanvasSize=setGLCanvasSize;var _GLRenderPipeline=require(3),task=void 0;function init(a){var b=a.fullScreen,c=a.drawers,e=a.renders,f=Flip.$('#gl-cvs');task=new _GLRenderPipeline.GLRenderPipeline({name:'test-gl',canvas:f,display:b?_GLRenderPipeline.CANVAS_DISPLAY_MODE_FULL_SCREEN:_GLRenderPipeline.CANVAS_DISPLAY_MODE_ORIGIN,clear:Flip.GL.COLOR_BUFFER_BIT}),task.init({preserveDrawingBuffer:!0}),e&&e.forEach(function(g){return task.add(g)}),Flip.instance.add(task),c.forEach(function(g){return task.addDrawer(g)})}function setGLCanvasSize(a,b){var c=Flip.$('#gl-cvs');c.width=a,c.height=b}

},{"3":3}],17:[function(require,module,exports){
(function (global){
'use strict';var _Mathceil=Math.ceil;Object.defineProperty(exports,'__esModule',{value:!0}),exports.createViewport=createViewport,exports.viewportEquals=viewportEquals,exports.alignCanvas=alignCanvas;var defaultDPI=exports.defaultDPI=global.devicePixelRatio||1;function createViewport(a,b,c){a=_Mathceil(a),b=_Mathceil(b);var d=a/b;return c=c||defaultDPI,Object.freeze({width:+a,height:+b,aspectRatio:d,displayWidth:_Mathceil(a/c),displayHeight:_Mathceil(b/c)})}function viewportEquals(a,b){return a&&b&&a.width===b.width&&a.height===b.height}function alignCanvas(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},c=b.element,d=c===void 0?document.documentElement:c,e=b.dpi,f=e===void 0?defaultDPI:e,g=b.extendScroll,h=a.style,i=d.clientWidth,j=d.clientHeight;a.width=i*f,a.height=j*f,h.width=i+'px',h.height=j+'px',g&&(h.position='fixed',h.left=0,h.top=0)}

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],18:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:!0}),exports.getCameraVideoOfSizeAsync=getCameraVideoOfSizeAsync;function getCameraVideoOfSizeAsync(a){return a||(a=[DEF_VIDEO_WIDTH,DEF_VIDEO_HEIGHT]),new Promise(function(b,c){navigator.mediaDevices.getUserMedia({audio:!1,video:{width:a[0],height:a[1]}}).then(function(d){var e=document.createElement('video');e.srcObject=d,e.play(),e.addEventListener('canplay',function f(){b({video:e,size:a}),e.removeEventListener('canplay',f)})},c)})}var DEF_VIDEO_WIDTH=exports.DEF_VIDEO_WIDTH=640,DEF_VIDEO_HEIGHT=exports.DEF_VIDEO_HEIGHT=480;

},{}]},{},[13]);
