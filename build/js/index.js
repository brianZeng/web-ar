(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var _animations=require(6);Object.keys(_animations).forEach(function(a){'default'===a||'__esModule'===a||Object.defineProperty(exports,a,{enumerable:!0,get:function get(){return _animations[a]}})}),exports.isTransitioning=isTransitioning,exports.transitionAnimationAsync=transitionAnimationAsync;var _index=require(6),_WaveStage=require(26),_image=require(39),BG_IMGS={night:Flip.$('img.night'),snow:Flip.$('img.snow'),sun:Flip.$('img.sun'),rain:Flip.$('img.rain'),none:Flip.$('img.none')},wave=new _WaveStage.WaveStage({waveSpeed:8}),mng=new _index.AnimationManager,currentImg=void 0;mng.pipeline.addDrawer(wave),(0,_image.loadImageAsync)(BG_IMGS.none).then(init);function init(a){Flip.instance.add(mng.pipeline),document.body.appendChild(mng.pipeline.canvas),mng.pipeline.init(),wave.setBackground(currentImg=a,a),Flip.$('.weather-selection').addEventListener('click',function(b){var c=b.target,d=c.classList;if(d.contains('icon')&&!mng.transioning){var f=Flip.$('.icon.current');f&&f.classList.remove('current'),d.add('current'),transitionAnimationAsync(c.getAttribute('class'))}})}var transitioning=void 0;function isTransitioning(){return transitioning}function transitionAnimationAsync(a){if(!transitioning){var b=_index.ANIMATION_NONE,c=BG_IMGS.none;return-1<a.indexOf('snow')?(b|=_index.ANIMATION_SNOW,c=BG_IMGS.snow):-1<a.indexOf('rain')?(b|=_index.ANIMATION_RAIN,c=BG_IMGS.rain):-1<a.indexOf('sun')?(b|=_index.ANIMATION_SUN,c=BG_IMGS.sun):-1<a.indexOf('moon')&&(b|=_index.ANIMATION_MOON|_index.ANIMATION_STAR,c=BG_IMGS.night),transitioning=!0,backgroundTransitionAsync(c).then(function(){return mng.transitionAnimationAsync(b)}).then(function(){return transitioning=!1})}return Promise.reject('transitioning')}function backgroundTransitionAsync(a){if(a!==currentImg.src){var b;return(0,_image.loadImageAsync)(a).then(function(c){return wave.transitionBackgroundAsync(currentImg,b=c)}).then(function(){return currentImg=b})}return Promise.resolve(currentImg)}

},{"26":26,"39":39,"6":6}],2:[function(require,module,exports){
'use strict';var _createClass=function(){function b(c,d){for(var f,e=0;e<d.length;e++)f=d[e],f.enumerable=f.enumerable||!1,f.configurable=!0,'value'in f&&(f.writable=!0),Object.defineProperty(c,f.key,f)}return function(c,d,e){return d&&b(c.prototype,d),e&&b(c,e),c}}(),_moon=require(8),_rain=require(12),_snow=require(15),_sun=require(23),_star=require(18),_math=require(40),_GLRenderPipeline=require(4),_const=require(5);var _MathPI=Math.PI;Object.defineProperty(exports,'__esModule',{value:!0}),exports.AnimationManager=void 0;function _classCallCheck(b,c){if(!(b instanceof c))throw new TypeError('Cannot call a class as a function')}var Promise=Flip.Promise,ANIMATION_TYPES=[_const.ANIMATION_NONE,_const.ANIMATION_SUN,_const.ANIMATION_STAR,_const.ANIMATION_SNOW,_const.ANIMATION_RAIN,_const.ANIMATION_MOON],MOON_ROTATE_PERCENT=0.65,AnimationManager=exports.AnimationManager=function(){function b(){_classCallCheck(this,b),this.pipeline=new _GLRenderPipeline.GLRenderPipeline({canvas:document.createElement('canvas'),display:_GLRenderPipeline.CANVAS_DISPLAY_MODE_FULL_SCREEN}),this.animations={},this._currentAnimations=[],this.transioning=!1}return _createClass(b,[{key:'transitionAnimationAsync',value:function transitionAnimationAsync(c){var d=this;if(this.transioning)return Promise.reject();this.transioning=!0;for(var e=ANIMATION_TYPES.filter(function(j){return j&c}).map(function(j){return d.getAnimation(j)}),f=this._currentAnimations.slice(),g=[],j=0;j<e.length;j++){var k=e[j],l=f.indexOf(k);k.disabled=!1,-1<k?f[l]=null:g.push(k)}var h=f.filter(function(j){return j});return Promise.all([Promise.all(g.map(function(j){return d.fadeAnimationAsync(j,!0)})),Promise.all(h.map(function(j){return d.fadeAnimationAsync(j,!1)}))]).then(function(){d._currentAnimations=e,h.forEach(function(j){return j.disabled=!0}),d.transioning=!1})}},{key:'fadeAnimationAsync',value:function fadeAnimationAsync(c,d){return(Number.isInteger(c)&&(c=this.getAnimation(c)),c.type==_const.ANIMATION_SUN)?this.fadeSunAsync(c,d):c.type==_const.ANIMATION_RAIN||c.type==_const.ANIMATION_SNOW?this.fadeRainAsync(c,d):c.type==_const.ANIMATION_MOON?this.fadeMoonAsync(c,d):c.type==_const.ANIMATION_STAR?this.fadeStarAsync(c,d):Promise.resolve()}},{key:'fadeStarAsync',value:function fadeStarAsync(c,d){return Flip.animate({duration:.7,ease:Flip.EASE.sineInOut,onUpdate:function onUpdate(){c.opacity=d?this.percent:1-this.percent}}).promise}},{key:'fadeMoonAsync',value:function fadeMoonAsync(c,d){var e,f;return d?(e=2.7,f=Flip.EASE.sineInOut):(e=2,f=Flip.EASE.quartIn),Flip.animate({duration:e,ease:f,onUpdate:function onUpdate(){var g=d?1-MOON_ROTATE_PERCENT*this.percent:(0,_math.mapRange)(1-MOON_ROTATE_PERCENT,0,this.percent);c.position=c.calRotatePos(_MathPI*g)}}).promise}},{key:'fadeRainAsync',value:function fadeRainAsync(c,d){var e=d?2.7:.7;return Flip.animate({duration:e,onUpdate:function onUpdate(){c.rainEffectIntensity=d?this.percent:1-this.percent}}).promise}},{key:'fadeSunAsync',value:function fadeSunAsync(c,d){if(d){c.setSunColor({a:1}),c.sunlightRotateParam=[0,0];return Flip.animate({duration:8*0.7,ease:Flip.EASE.sineInOut,onUpdate:function onUpdate(){var g=this.percent;changeSunByDayPercent(c,g*0.7+0)}}).promise}return Flip.animate({duration:.7,ease:Flip.EASE.sineInOut,onUpdate:function onUpdate(){var e=1-this.percent;c.lensFlaresIntensity=e,c.setSunColor({a:e})}}).promise}},{key:'getAnimation',value:function getAnimation(c){var d=this.animations[c];return d||(d=c==_const.ANIMATION_MOON?(0,_moon.getMoonDrawer)(0):c==_const.ANIMATION_RAIN?(0,_rain.getRainDrawer)():c==_const.ANIMATION_SNOW?(0,_snow.getSnowDrawer)():c==_const.ANIMATION_SUN?(0,_sun.getVertexSunDrawer)():c==_const.ANIMATION_STAR?(0,_star.getStarDrawer)():new GLDrawer,this.animations[c]=d,d.disabled=!0,this.pipeline.addDrawer(d)),d}}]),b}();function changeSunByDayPercent(b,c){b.rotatePositionAndDirection((0,_sun.getVertexSunDrawerAnimateParam)(c)),b.lensFlaresIntensity=(0,_math.mapRange)(0,0.3,Math.sin(_MathPI*c)),b.invalid()}

},{"12":12,"15":15,"18":18,"23":23,"4":4,"40":40,"5":5,"8":8}],3:[function(require,module,exports){
'use strict';var _createClass=function(){function a(b,c){for(var e,d=0;d<c.length;d++)e=c[d],e.enumerable=e.enumerable||!1,e.configurable=!0,'value'in e&&(e.writable=!0),Object.defineProperty(b,e.key,e)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_const=require(5);Object.defineProperty(exports,'__esModule',{value:!0}),exports.GLDrawer=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a}function _inherits(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var GLDrawer=exports.GLDrawer=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return _inherits(b,a),_createClass(b,[{key:'viewportResize',value:function viewportResize(){}},{key:'type',get:function get(){return _const.ANIMATION_NONE}}]),b}(Flip.GL.Stage);

},{"5":5}],4:[function(require,module,exports){
'use strict';var _createClass=function(){function a(b,c){for(var f,d=0;d<c.length;d++)f=c[d],f.enumerable=f.enumerable||!1,f.configurable=!0,'value'in f&&(f.writable=!0),Object.defineProperty(b,f.key,f)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_get=function a(b,c,d){null===b&&(b=Function.prototype);var f=Object.getOwnPropertyDescriptor(b,c);if(f===void 0){var g=Object.getPrototypeOf(b);return null===g?void 0:a(g,c,d)}if('value'in f)return f.value;var h=f.get;return void 0===h?void 0:h.call(d)},_viewport=require(44);Object.defineProperty(exports,'__esModule',{value:!0}),exports.GLRenderPipeline=exports.CANVAS_DISPLAY_MODE_FULL_CONTENT_SCROLL=exports.CANVAS_DISPLAY_MODE_ORIGIN=exports.CANVAS_DISPLAY_MODE_FULL_SCREEN=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a}function _inherits(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var CANVAS_DISPLAY_MODE_FULL_SCREEN=exports.CANVAS_DISPLAY_MODE_FULL_SCREEN='full-screen',CANVAS_DISPLAY_MODE_ORIGIN=exports.CANVAS_DISPLAY_MODE_ORIGIN='origin',CANVAS_DISPLAY_MODE_FULL_CONTENT_SCROLL=exports.CANVAS_DISPLAY_MODE_FULL_CONTENT_SCROLL='full-scroll',GLRenderPipeline=exports.GLRenderPipeline=function(a){function b(c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c));return d.dpi=c.dpi||_viewport.defaultDPI,d.canvas=c.canvas,d.viewport=d.getCanvasViewport(),d.canvasDisplayMode=c.display||CANVAS_DISPLAY_MODE_FULL_SCREEN,d.drawers=[],d}return _inherits(b,a),_createClass(b,[{key:'init',value:function init(c){_get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),'init',this).call(this,c)}},{key:'addDrawer',value:function addDrawer(c){return this.add(c)&&(c.parentPipeline=this,this.drawers.push(c),c.viewportResize(this.viewport)),this}},{key:'update',value:function update(c){if(!this.disabled){_get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),'update',this).call(this,c);var d=this.getCanvasParentViewport();(0,_viewport.viewportEquals)(this.parentViewport,d)||(this.alignCanvas(),this.parentViewport=d);var f=this.getCanvasViewport();(0,_viewport.viewportEquals)(this.viewport,f)||this.onViewportResize(f,c.gl),this.drawers.forEach(function(g){return!g.disabled&&g.update(c)})}}},{key:'onViewportResize',value:function onViewportResize(c,d){this.viewport=c,d&&d.viewport(0,0,c.width,c.height),this.drawers.forEach(function(f){f.viewportResize(c),f.invalid()})}},{key:'getCanvasParentViewport',value:function getCanvasParentViewport(){var c=this.canvas.parentElement;if(c){var d=this.canvasDisplayMode==CANVAS_DISPLAY_MODE_FULL_CONTENT_SCROLL,f=d?c.scrollWidth:c.clientWidth,g=d?c.scrollHeight:c.clientHeight;return(0,_viewport.createViewport)(f,g,this.dpi)}return(0,_viewport.createViewport)(0,0,this.dpi)}},{key:'alignCanvas',value:function alignCanvas(){var c=this.canvasDisplayMode==CANVAS_DISPLAY_MODE_FULL_CONTENT_SCROLL;(this.canvasDisplayMode==CANVAS_DISPLAY_MODE_FULL_SCREEN||c)&&(0,_viewport.alignCanvas)(this.canvas,{extendScroll:c})}},{key:'getCanvasViewport',value:function getCanvasViewport(){var c=this.canvas;return(0,_viewport.createViewport)(c.width,c.height,this.dpi)}}]),b}(Flip.GL.Task);

},{"44":44}],5:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ANIMATION_NONE=exports.ANIMATION_NONE=0,ANIMATION_SNOW=exports.ANIMATION_SNOW=1,ANIMATION_STAR=exports.ANIMATION_STAR=2,ANIMATION_MOON=exports.ANIMATION_MOON=4,ANIMATION_SUN=exports.ANIMATION_SUN=8,ANIMATION_RAIN=exports.ANIMATION_RAIN=16;

},{}],6:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var _const=require(5);Object.keys(_const).forEach(function(a){'default'===a||'__esModule'===a||Object.defineProperty(exports,a,{enumerable:!0,get:function get(){return _const[a]}})});var _AnimationManager=require(2);Object.keys(_AnimationManager).forEach(function(a){'default'===a||'__esModule'===a||Object.defineProperty(exports,a,{enumerable:!0,get:function get(){return _AnimationManager[a]}})});

},{"2":2,"5":5}],7:[function(require,module,exports){
'use strict';var _createClass=function(){function a(b,c){for(var e,d=0;d<c.length;d++)e=c[d],e.enumerable=e.enumerable||!1,e.configurable=!0,'value'in e&&(e.writable=!0),Object.defineProperty(b,e.key,e)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_shader=require(9),_math=require(40),_utils=require(43),_GLDrawer2=require(3),_const=require(5);Object.defineProperty(exports,'__esModule',{value:!0}),exports.MoonDrawer=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a}function _inherits(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var SHADOW_DRAW_INTERSECT=1,SHADOW_DRAW_EXCLUDE=2,MoonDrawer=exports.MoonDrawer=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return _inherits(b,a),_createClass(b,[{key:'createScenes',value:function createScenes(){var e=new Flip.GL.Scene({fragShader:_shader.frag_shader,vertexShader:_shader.vertex_shader,name:'main'});return e.addBinder(e.buildBinder({aPos:new Float32Array([0,0]),uPointSize:128,uShadowDraw:SHADOW_DRAW_EXCLUDE,uShadowX:0,uPointColor:[1,1,1,1],blend:function blend(f){f.enable(f.BLEND),f.blendFunc(f.SRC_ALPHA,f.ONE_MINUS_SRC_ALPHA)}})),e.add(createPointsGeometry()),[this.scene=e]}},{key:'shadowByMoonPhrase',value:function shadowByMoonPhrase(c,d){var e,f=0.5<c?(0,_math.mapRange)(1,0,(c-0.5)/.5):(0,_math.mapRange)(1,0,(0.5-c)/.5);e=0.5<f?SHADOW_DRAW_INTERSECT:SHADOW_DRAW_EXCLUDE;var g=(0,_math.mapRange)(1,-1,f);(0,_utils.isFunc)(d)&&(g=d(g)),this.setVecUniform(this.scene,'uShadowX',g),this.setVecUniform(this.scene,'uShadowDraw',e)}},{key:'calRotatePos',value:function calRotatePos(c){return[1.1*Math.cos(c),.8*Math.sin(c)]}},{key:'moonColor',set:function set(c){this.setVecUniform(this.scene,'uPointColor',c)}},{key:'position',get:function get(){var c=this.scene.binder.aPos.data;return[c[0],c[1]]},set:function set(c){this.scene.binder.aPos.data=new Float32Array(c),this.invalid()}},{key:'type',get:function get(){return _const.ANIMATION_MOON}}]),b}(_GLDrawer2.GLDrawer);function createPointsGeometry(){return new Flip.GL.Mesh({primitive:Flip.GL.POINTS,drawCount:1})}

},{"3":3,"40":40,"43":43,"5":5,"9":9}],8:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:!0}),exports.getMoonDrawer=getMoonDrawer;var _MoonDrawer=require(7),_math=require(40);function getMoonDrawer(a){var b=new _MoonDrawer.MoonDrawer;return b.moonColor=[0.996078431372549,0.9725490196078431,0.7843137254901961],b.shadowByMoonPhrase(a||0.1,mapShadowX),b}function mapShadowX(a){var b=0>a?-1:1;return(0,_math.mapRange)(0.3,1,Math.abs(a))*b}

},{"40":40,"7":7}],9:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var vertex_shader=exports.vertex_shader="\nattribute vec2 aPos;\n\nuniform float uPointSize;\n\nvoid main(){\n  gl_Position= vec4(aPos,0.0,1.0);\n  gl_PointSize= uPointSize;\n}\n",frag_shader=exports.frag_shader="\nprecision mediump float;\n\nconst int SHADOW_DRAW_INTERSECT = 1;\nconst int SHADOW_DRAW_EXCLUDE = 2;\nconst float cBlurRadius = 0.06;\nuniform float uShadowX;\nuniform int uShadowDraw;\nuniform vec4 uPointColor;\n\nvoid main(){\n  vec2 pos =(gl_PointCoord.xy - 0.5) * 2.0 * 1.1;\n  vec4 pointColor = uPointColor;\n  float radius = length(pos);\n  if(radius > 1.0+ cBlurRadius){\n    discard;\n  }\n  float alpha = 1.0 - smoothstep(1.0,1.0 + cBlurRadius,radius);\n  float m = uShadowX;\n  float x = pos.x;\n  float y = pos.y;\n  float r = (x*x)/(m*m) + y*y;\n  if(uShadowDraw == SHADOW_DRAW_EXCLUDE){\n    if(x < 0.0){ discard; }\n    if(r < 1.0){\n      alpha = smoothstep(1.0 - cBlurRadius * 2.0,1.0,r);\n    }\n  }\n  else if(uShadowDraw == SHADOW_DRAW_INTERSECT){\n    if(x < 0.0 && r >= 1.0 - cBlurRadius * 2.0){\n       alpha = 1.0 - smoothstep(1.0,1.0 + cBlurRadius * 2.0 ,r);\n    }\n  }\n \n  gl_FragColor = pointColor * alpha ;\n}\n",debug_vertex_shader=exports.debug_vertex_shader="\n#ifdef GL_ES\nprecision mediump float;\n#endif\n\nattribute vec2 aQuad;\nvarying vec2 vTexIndex;\n\nvoid main(){\n  vTexIndex= aQuad;\n  gl_Position = vec4(aQuad * 2.0 -1.0, 0.0, 1.0);\n}\n",debug_frag_shader=exports.debug_frag_shader="\nprecision mediump float;\n\nuniform vec2 uTexSize;\nuniform sampler2D uSampler;\n\nvarying vec2 vTexIndex;\n\nconst float SIGMA = 6.2;\nconst vec2 uBlurDirection = vec2(0.001, 0.001);\nconst int BLUR_RADIUS = 32;\n\nvec4 incrementalGauss1D(sampler2D s,vec2 size,vec2 origin,vec2 direction);\n\nvoid main(){\n  vec2 texSize = 1.0 / uTexSize;\n  vec2 texIndex= vTexIndex;\n \n  vec4 blurColor=incrementalGauss1D(uSampler,texSize,texIndex,uBlurDirection);\n  gl_FragColor= vec4(blurColor.rgb,texture2D(uSampler,texIndex).a);\n  //gl_FragColor= texture2D(uSampler,texIndex);\n}\n\nvec4 incrementalGauss1D(\n\tsampler2D srcTex, \n\tvec2 srcTexelSize, \n\tvec2 origin,\n\tvec2 direction\n) {\n\n\tif (BLUR_RADIUS == 0)\n\t\treturn texture2D(srcTex, origin);\n\t\n\tfloat sig2 = SIGMA * SIGMA;\n\tconst float TWO_PI\t= 6.2831853071795;\n\tconst float E\t\t\t= 2.7182818284590;\n\t\t\n//\tset up incremental counter:\n\tvec3 gaussInc;\n\tgaussInc.x = 1.0 / (sqrt(TWO_PI) * SIGMA);\n\tgaussInc.y = exp(-0.5 / sig2);\n\tgaussInc.z = gaussInc.y * gaussInc.y;\n\t\n//\taccumulate results:\n\tvec4 result = texture2D(srcTex, origin) * gaussInc.x;\t\n\tfor (int i = 1; i < BLUR_RADIUS/2; ++i) {\n\t\tgaussInc.xy *= gaussInc.yz;\n\t\t\n\t\tvec2 offset = float(i) * direction * srcTexelSize;\n\t\tresult += texture2D(srcTex, origin - offset) * gaussInc.x;\n\t\tresult += texture2D(srcTex, origin + offset) * gaussInc.x;\n\t}\n\t\n\treturn result;\n}\n";

},{}],10:[function(require,module,exports){
'use strict';var _createClass=function(){function a(b,c){for(var f,d=0;d<c.length;d++)f=c[d],f.enumerable=f.enumerable||!1,f.configurable=!0,'value'in f&&(f.writable=!0),Object.defineProperty(b,f.key,f)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_get=function a(b,c,d){null===b&&(b=Function.prototype);var f=Object.getOwnPropertyDescriptor(b,c);if(f===void 0){var g=Object.getPrototypeOf(b);return null===g?void 0:a(g,c,d)}if('value'in f)return f.value;var h=f.get;return void 0===h?void 0:h.call(d)},_RainRender=require(11),_shader=require(13),shader=_interopRequireWildcard(_shader),_GLDrawer2=require(3),_const=require(5);var _Mathmin=Math.min;Object.defineProperty(exports,'__esModule',{value:!0}),exports.RainDrawer=void 0;function _interopRequireWildcard(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a}function _inherits(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var RainDrawer=exports.RainDrawer=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return _inherits(b,a),_createClass(b,[{key:'classConfigureArgument',value:function classConfigureArgument(){return{define:{DRAW_RAIN:1}}}},{key:'createScenes',value:function createScenes(){var d=this.classConfigureArgument(),f=new Flip.GL.Scene({fragShader:shader.DRAW_FRAGE_SHADER,vertexShader:shader.DRAW_VERTEX_SHADER,define:d.define});f.addBinder(f.buildBinder({uPointWidth:0.01,uPointSizeScale:1,uDiscardThreshold:1,uViewProjectionMatrix:new Flip.GL.Matrix4,blend:function blend(h){h.enable(h.BLEND),h.blendFunc(h.SRC_ALPHA,h.ONE)}}));var g=new Flip.GL.Scene({fragShader:shader.UPDATE_FRAGE_SHADER,vertexShader:shader.UPDATE_VERTEX_SHADER,define:d.define});return g.addBinder(g.buildBinder({uTimeDelta:[0,0],uAcceleration:[0,0,0],uResistance:[0,0,0],uVecRange:[0,0,0,0],uNoise:null,uTexRandom:function uTexRandom(){return[Math.random(),Math.random()]}})),this.updateScene=g,this.drawScene=f,this.frameTimeRatio=100,this.pointCountPerThousandPixel=500,[g,f]}},{key:'update',value:function update(c){if(_get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),'update',this).call(this,c),this.frameTimeRatio){var d=Date.now(),f=this.lastUpdateTime||d,g=d-f;if(0<this.rainEffectIntensity&&15<g){g=_Mathmin(g,100/3);var h=g/this.frameTimeRatio;this.setFrameTime(h,h),this.invalid()}this.lastUpdateTime=d}}},{key:'setPoints',value:function setPoints(c){var d=new _RainRender.RainRender;return d.setPoints(c),this.updateScene.add(d._vecUpdateGeometry),this.updateScene.add(d._posUpdateGeometry),this.drawScene.add(d._drawGeometry),this.currentRainRender=d}},{key:'viewportResize',value:function viewportResize(c){var d=this.currentRainRender,f=Math.round(c.displayWidth/1e3*this.pointCountPerThousandPixel);d&&(d.drawCount=_Mathmin(d.maxDrawCount,f))}},{key:'setFrameTime',value:function setFrameTime(c,d){var f;return this.setVecUniform(this.updateScene,'uTimeDelta',(f={},_defineProperty(f,_RainRender.UPDATE_PHRASE_POS,c),_defineProperty(f,_RainRender.UPDATE_PHRASE_VEC,d),f))}},{key:'setResistance',value:function setResistance(c,d,f){return this.setVecUniform(this.updateScene,'uResistance',[c,d,f])}},{key:'setNoiseSource',value:function setNoiseSource(c){this.updateScene.binder.uNoise.source=c,this.invalid()}},{key:'setVecRange',value:function setVecRange(c,d,f,g){return this.setVecUniform(this.updateScene,'uVecRange',[c,d,f,g])}},{key:'setAcceleration',value:function setAcceleration(c,d,f){return this.setVecUniform(this.updateScene,'uAcceleration',[c,d,f])}},{key:'type',get:function get(){return _const.ANIMATION_RAIN}},{key:'rainEffectIntensity',set:function set(c){this.drawScene.binder.uDiscardThreshold.value=+c},get:function get(){return this.drawScene.binder.uDiscardThreshold.value}}]),b}(_GLDrawer2.GLDrawer);

},{"11":11,"13":13,"3":3,"5":5}],11:[function(require,module,exports){
'use strict';var _slicedToArray=function(){function a(b,c){var d=[],e=!0,f=!1,g=void 0;try{for(var j,h=b[Symbol.iterator]();!(e=(j=h.next()).done)&&(d.push(j.value),!(c&&d.length===c));e=!0);}catch(k){f=!0,g=k}finally{try{!e&&h['return']&&h['return']()}finally{if(f)throw g}}return d}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError('Invalid attempt to destructure non-iterable instance')}}(),_createClass=function(){function a(b,c){for(var e,d=0;d<c.length;d++)e=c[d],e.enumerable=e.enumerable||!1,e.configurable=!0,'value'in e&&(e.writable=!0),Object.defineProperty(b,e.key,e)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();Object.defineProperty(exports,'__esModule',{value:!0}),exports.RainRender=exports.UPDATE_PHRASE_VEC=exports.UPDATE_PHRASE_POS=void 0;exports.encodePoints=encodePoints,exports.swapTextureAfterDraw=swapTextureAfterDraw,exports.mapColorVal=mapColorVal,exports.createFloatSampler=createFloatSampler;var _math=require(40),_color=require(38);function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var UPDATE_PHRASE_POS=exports.UPDATE_PHRASE_POS=0,UPDATE_PHRASE_VEC=exports.UPDATE_PHRASE_VEC=1,SAMPLER_DATA_POINT_SIZE=2,RainRender=exports.RainRender=function(){function a(){var b,c;_classCallCheck(this,a);var d=this._posSampler=createFloatSampler('uPosBuffer'),e=this._vecSampler=createFloatSampler('uVecBuffer'),f=this._texIndexBuffer=new Flip.GL.Buffer({data:new Float32Array(0)}),g=this._framebuffer=new Flip.GL.FrameBuffer({dataFormat:Flip.GL.FLOAT,textureParam:{TEXTURE_MAG_FILTER:Flip.GL.NEAREST,TEXTURE_MIN_FILTER:Flip.GL.NEAREST}}),h=new Flip.GL.Attribute({name:'aTexIndex',data:f}),j=this._posUpdateGeometry=new Flip.GL.Mesh({primitive:Flip.GL.POINTS,binder:(b={},_defineProperty(b,d.name,d),_defineProperty(b,e.name,e),_defineProperty(b,'uUpdatePhrase',new Flip.GL.Uniform({name:'uUpdatePhrase',value:UPDATE_PHRASE_POS,type:'int'})),_defineProperty(b,'aTexIndex',h),b)}),k=this._vecUpdateGeometry=new Flip.GL.Mesh({primitive:Flip.GL.POINTS,binder:(c={},_defineProperty(c,d.name,d),_defineProperty(c,e.name,e),_defineProperty(c,'uUpdatePhrase',new Flip.GL.Uniform({name:'uUpdatePhrase',value:UPDATE_PHRASE_VEC,type:'int'})),_defineProperty(c,'aTexIndex',h),c)});swapTextureAfterDraw(k,e,g),swapTextureAfterDraw(j,d,g),this._drawGeometry=new Flip.GL.Mesh({primitive:Flip.GL.POINTS,binder:{aTexIndex:h,aPointSize:new Flip.GL.Attribute({name:'aPointSize',data:new Float32Array(0)}),aPointColor:new Flip.GL.Attribute({name:'aPointColor',data:new Float32Array(0)}),uPointOpacity:new Flip.GL.Uniform({name:'uPointOpacity',value:1})},beforeDraw:function beforeDraw(l,m){g.unbind(l),d.bind(l,m),e.bind(l,m),l.viewport(0,0,l.drawingBufferWidth,l.drawingBufferHeight)}})}return _createClass(a,[{key:'maxDrawCount',get:function get(){return this._pointCount}},{key:'drawCount',set:function set(b){if(isNaN(b)||b>this.maxDrawCount)throw Error('invalid drawCount');this._drawGeometry.drawCount=+b}}]),_createClass(a,[{key:'setPoints',value:function setPoints(b){return this.setEncodedPoints(encodePoints(b))}},{key:'setEncodedPoints',value:function setEncodedPoints(b){var c=b.width,d=b.height;return this._posSampler.source={width:c,height:d,data:b.pos,format:Flip.GL.RGB},this._vecSampler.source={width:c,height:d,data:b.vec,format:Flip.GL.RGB},this._framebuffer.width=c*SAMPLER_DATA_POINT_SIZE,this._framebuffer.height=d*SAMPLER_DATA_POINT_SIZE,this._texIndexBuffer.data=b.index,this._pointCount=this._drawGeometry.drawCount=this._posUpdateGeometry.drawCount=this._vecUpdateGeometry.drawCount=b.count,this._drawGeometry.binder.aPointColor.data=b.color,this._drawGeometry.binder.aPointSize.data=b.size,this}}]),a}();function encodePoints(a){for(var b=a.length,c=(0,_math.parseSqrt)(b),d=_slicedToArray(c,2),e=d[0],f=d[1],g=new Float32Array(3*(e*f)),h=new Float32Array(3*(e*f)),j=new Float32Array(4*(e*f)),k=new Float32Array(2*(e*f)),l=new Float32Array(e*f),m=0,n=0,o=0,p=0,q=0;m<b;m++){var r=a[m],s=r.color?(0,_color.parseColor)(r.color):(0,_color.randomColor)();g[n++]=mapColorVal(r.x||0),g[n++]=mapColorVal(r.y||0),g[n++]=mapColorVal(r.z||0),h[o++]=mapColorVal(r.vx||0),h[o++]=mapColorVal(r.vy||0),h[o++]=mapColorVal(r.vz||0),j[p++]=s[0],j[p++]=s[1],j[p++]=s[2],j[p++]=s[3],l[m]=r.size;var t=m%e,u=(m-t)/e;k[q++]=t/e+1/(2*e),k[q++]=u/f+1/(2*f)}return{pos:g,vec:h,color:j,index:k,count:b,size:l,width:e,height:f}}function swapTextureAfterDraw(a,b,c){a.beforeDraw=function(d,e){d.viewport(0,0,c._w,c._h),c.bind(d,e)},a.afterDraw=function(d,e){var f=b.texture;b.texture=c.texture,c.texture=f,c.shouldCheckComplete=!1,b.source=null,b.bind(d,e)}}function mapColorVal(a){return+(a+1)/2}function createFloatSampler(a,b){return new Flip.GL.Sampler2D({dataFormat:Flip.GL.FLOAT,flipY:!1,name:a,textureParam:{TEXTURE_MAG_FILTER:Flip.GL.NEAREST,TEXTURE_MIN_FILTER:Flip.GL.NEAREST},source:b||null})}

},{"38":38,"40":40}],12:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:!0}),exports.defaultRainConfiguration=exports.RainDrawer=void 0,exports.getRainDrawer=getRainDrawer,exports.configRainDrawer=configRainDrawer;var _RainDrawer=require(10),_noise=require(41),_math=require(40);exports.RainDrawer=_RainDrawer.RainDrawer;var DPI=window.devicePixelRatio||1,defaultRainConfiguration=exports.defaultRainConfiguration={acceleration:[0,-0.1],frameTimeRatio:200,resistance:[0,0.18,0],vxRange:[-0.06,-0.006],vyRange:[-0.4,0],sizeRange:[16*DPI,32*DPI],pointCountPerThousandPixel:96};function getRainDrawer(){var b=new _RainDrawer.RainDrawer;return configRainDrawer(b)}function configRainDrawer(a,b){var c=Object.assign({sizeEasing:Flip.EASE.quadInOut},defaultRainConfiguration,b);a.setAcceleration.apply(a,c.acceleration),a.setResistance.apply(a,c.resistance),a.setNoiseSource(b&&b.noiseData||(0,_noise.randomNoiseData)({min:0,max:255})),a.setVecRange(c.vxRange[0],c.vxRange[1],c.vyRange[0],c.vyRange[1]);var d=Math.ceil(screen.availWidth/1e3)*c.pointCountPerThousandPixel;return a.setPoints(randomRain(d,c)),a.pointCountPerThousandPixel=c.pointCountPerThousandPixel,a.frameTimeRatio=c.frameTimeRatio,a}function randomRain(a,b){for(var c=b.vxRange,d=b.vyRange,e=b.sizeRange,f=b.sizeEasing,g=[],h=0;h<a;h++)g.push({y:(0,_math.random)(-1,1),x:(0,_math.random)(-1,1),z:0,color:'rgba(232,232,232,'+(0,_math.random)(0.2,0.9).toFixed(1)+')',vx:(0,_math.random)(c[0],c[1]),vy:(0,_math.random)(d[0],d[1]),vz:0,size:(0,_math.random)(e[0],e[1],f||Flip.EASE.linear)});return g}

},{"10":10,"40":40,"41":41}],13:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var UPDATE_VERTEX_SHADER=exports.UPDATE_VERTEX_SHADER="\nprecision mediump float;\n\nattribute vec2 aTexIndex;\nvarying vec2 vTexIndex;\nconst float SAMPLER_DATA_POINT_SIZE = 2.0;\n\nvoid main(){\n  vTexIndex = aTexIndex;\n  gl_Position = vec4(aTexIndex * 2.0 - 1.0, 0.0, 1.0);\n  gl_PointSize= SAMPLER_DATA_POINT_SIZE;\n}\n",UPDATE_FRAGE_SHADER=exports.UPDATE_FRAGE_SHADER="\nprecision mediump float;\n\nuniform sampler2D uVecBuffer;\nuniform sampler2D uPosBuffer;\nuniform sampler2D uNoise;\nuniform vec2 uTimeDelta;\nuniform int uUpdatePhrase;\nuniform vec3 uAcceleration;\nuniform vec3 uResistance;\nuniform vec2 uTexRandom;\nuniform vec4 uVecRange;\nvarying vec2 vTexIndex;\n\nconst int UPDATE_PHRASE_POS= 0;\nconst int UPDATE_PHRASE_VEC= 1;\nconst float BOUNCE_DECREASE= 2.0/3.0;\n\nbool outOfBound(vec2 pos);\nvec2 interpolateVecRange(vec4 range,vec2 p);\nvoid main(){\n  vec3 curVec = texture2D(uVecBuffer,vTexIndex).xyz * 2.0 - 1.0;\n  vec3 curPos = texture2D(uPosBuffer,vTexIndex).xyz * 2.0 - 1.0;\n  vec3 _output;\n  if(uUpdatePhrase == UPDATE_PHRASE_POS){\n    if(outOfBound(curPos.xy)){\n      vec4 noise = texture2D(uNoise,fract(vTexIndex + uTexRandom + curVec.xy));\n      float x =(fract(noise.x * 6.282) -0.5) * 3.0;\n      _output=vec3(x, 1.0, _output.z);\n    }\n    else{\n      _output = curPos + curVec * uTimeDelta[UPDATE_PHRASE_POS];\n    }\n  }\n  else if(uUpdatePhrase == UPDATE_PHRASE_VEC){\n    vec3 resistance = uResistance * curVec;\n    _output = curVec + (uAcceleration - resistance) * uTimeDelta[UPDATE_PHRASE_VEC];\n    if(outOfBound(curPos.xy)){\n        vec2 noise = texture2D(uNoise,fract(vTexIndex+ uTexRandom * 4.0)).xy;\n        _output.xy = interpolateVecRange(uVecRange,vec2(noise.y));\n    }\n  }\n  gl_FragColor = vec4(( _output  + 1.0 ) / 2.0 ,1.0);\n}\nbool outOfBound(vec2 pos){\n  if(pos.y<= -1.0 || pos.x >= 2.0 || pos.x <= -2.0){\n    return true;\n  }\n  return false;\n}\nvec2 interpolateVecRange(vec4 range,vec2 p){\n  return vec2(range[0] + p[0] * range[1] ,range[2] + p[1] * range[3]);\n}\n",DRAW_VERTEX_SHADER=exports.DRAW_VERTEX_SHADER="\nprecision mediump float;\n\nuniform sampler2D uPosBuffer;\nuniform mat4 uViewProjectionMatrix;\nuniform float uPointSizeScale;\n\nattribute vec2 aTexIndex;\nattribute float aPointSize;\nattribute vec4 aPointColor;\n\nvarying vec4 vPointColor;\n\n#ifdef DRAW_RAIN\nuniform sampler2D uVecBuffer;\nvarying float vPointVelRatio;\n#endif\n\nvoid main(){\n  vec3 pos = (texture2D(uPosBuffer,aTexIndex).xyz) * 2.0 - 1.0;\n \n  gl_Position = uViewProjectionMatrix * vec4(pos,1.0);\n  \n  gl_PointSize = aPointSize * uPointSizeScale;\n#ifdef DRAW_SNOW\n  float y = (gl_Position.y +1.0)/2.0;\n  vPointColor = aPointColor * pow(y,0.2);\n#else\n  vPointColor = aPointColor;\n#endif\n  \n#ifdef DRAW_RAIN\n   vec2 vel = (texture2D(uVecBuffer,aTexIndex).xy * 2.0) -1.0;\n   if(vel.x !=0.0){\n     vPointVelRatio = -vel.y / vel.x;\n   }\n   else{\n     vPointVelRatio = 0.0;\n   }\n#endif\n}\n",DRAW_FRAGE_SHADER=exports.DRAW_FRAGE_SHADER="\nprecision mediump float;\n\n#ifdef DRAW_RAIN\nvarying float vPointVelRatio;\n#endif\n\nvarying vec4 vPointColor;\nuniform float uPointOpacity;\nuniform float uPointWidth;\nuniform float uDiscardThreshold;\n\nvoid main(){\n  float a=1.0;\n  if(vPointColor.a > uDiscardThreshold){\n    discard;\n  }\n#ifdef DRAW_RAIN\n    float x = gl_PointCoord.x;\n    float y = gl_PointCoord.y;\n    float LINE_X_END = 0.5 + uPointWidth /0.5;\n    float LINE_X_START = 0.5 - uPointWidth /0.5;\n    if(vPointVelRatio !=0.0){\n      float k=y/vPointVelRatio;\n      if( k > (x - LINE_X_START) || k < (x - LINE_X_END)){\n        discard;\n      }\n      else{\n         a = (y*(1.0+vPointVelRatio*vPointVelRatio))/(LINE_X_START * (1.0+vPointVelRatio*vPointVelRatio));\n         a = smoothstep(0.0,1.0,a)*0.7;\n      }   \n    }\n    else{\n      if(x < LINE_X_START || x > LINE_X_END)\n        discard;\n      //else \n        //a= y /1.0;\n    }\n#endif\n#ifdef DRAW_SNOW\n    float radius =length(gl_PointCoord - 0.5);\n    if(radius > 0.5){\n      discard;\n    }\n    a = clamp((radius -0.2)/(0.5-0.2),0.0,1.0);\n    a = pow(clamp(1.0 - a, 0.0 ,1.0),0.7);\n#endif\n  \n  gl_FragColor= vPointColor * uPointOpacity * a;\n}\n\n";

},{}],14:[function(require,module,exports){
'use strict';var _createClass=function(){function a(b,c){for(var e,d=0;d<c.length;d++)e=c[d],e.enumerable=e.enumerable||!1,e.configurable=!0,'value'in e&&(e.writable=!0),Object.defineProperty(b,e.key,e)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_RainDrawer2=require(10),_const=require(5);Object.defineProperty(exports,'__esModule',{value:!0}),exports.SnowDrawer=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a}function _inherits(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var SnowDrawer=exports.SnowDrawer=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return _inherits(b,a),_createClass(b,[{key:'classConfigureArgument',value:function classConfigureArgument(){return{define:{DRAW_SNOW:1}}}},{key:'onDrag',value:function onDrag(c){var d=this,e=c[0],f=e.accumulatedX/(e.timeStamp-e.startTime);0.5<Math.abs(f)&&(this.setAcceleration(this.getDragAcceleration(f)),setTimeout(function(){return d.setAcceleration(0)},1e3))}},{key:'getDragAcceleration',value:function getDragAcceleration(c){return 0<c?0.01:-0.01}},{key:'type',get:function get(){return _const.ANIMATION_SNOW}}]),b}(_RainDrawer2.RainDrawer);

},{"10":10,"5":5}],15:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:!0}),exports.defaultSnowConfiguration=exports.SnowDrawer=void 0,exports.getSnowDrawer=getSnowDrawer;var _rain=require(12),_SnowDrawer=require(14);exports.SnowDrawer=_SnowDrawer.SnowDrawer;var DPI=window.devicePixelRatio||1,defaultSnowConfiguration=exports.defaultSnowConfiguration=Object.assign({},_rain.defaultRainConfiguration,{pointCountPerThousandPixel:180,resistance:[0.2/DPI,5.6/DPI,0],vxRange:[-0.02*DPI,0.02*DPI],vyRange:[-0.04,0],sizeRange:[2*DPI,8*DPI]});function getSnowDrawer(a){var b=new _SnowDrawer.SnowDrawer,c=Object.assign(defaultSnowConfiguration,{sizeEasing:Flip.EASE.quartIn},a);return(0,_rain.configRainDrawer)(b,c)}

},{"12":12,"14":14}],16:[function(require,module,exports){
'use strict';var _createClass=function(){function a(b,c){for(var e,d=0;d<c.length;d++)e=c[d],e.enumerable=e.enumerable||!1,e.configurable=!0,'value'in e&&(e.writable=!0),Object.defineProperty(b,e.key,e)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();Object.defineProperty(exports,'__esModule',{value:!0});function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var defaultFontFamily='Avenir, Helvetica Neue, Helvetica, Arial, sans-serif',SpottedStringDrawer=exports.SpottedStringDrawer=function(){function a(){var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},c=b.textColor,d=void 0===c?'#fff':c,e=b.fontSize,f=void 0===e?160:e,g=b.fontFamily,h=void 0===g?defaultFontFamily:g,j=b.canvas;_classCallCheck(this,a),this.textColor=d,this.fontSize=f,this.fontFamily=h,this.canvas=j||document.createElement('canvas')}return _createClass(a,[{key:'getPointFromText',value:function getPointFromText(b,c){var d=this.ctx,e=this.canvas;return d.clearRect(0,0,e.width,e.height),this.drawText(b),this.getVisualPoints(c)}},{key:'drawText',value:function drawText(b){var c=this.fontSize,d=this.fontFamily,e=this.ctx,f=this.canvas,g=void 0;e.font=getFontString(c,d),g=Math.min(c,0.8*(f.width/e.measureText(b).width)*c,f.height/c*(isNumber(b)?1:0.8)*c),e.font=getFontString(g,d),e.textBaseline='top',e.textAlign='center',e.fillStyle=this.textColor,e.fillText(b,f.width/2,0,f.width)}},{key:'getVisualPoints',value:function getVisualPoints(){for(var b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},c=b.gap||6,d=b.pointRadius||2,e=this.ctx,f=this.canvas,g=e.getImageData(0,0,f.width,f.height),h=g.data,j=[],k=g.width,l=b.normalize,m=b.normalize?f.width:1,o=b.normalize?f.height:1,p=0,q=h.length,r=0,s=0;p<q;p+=4*c){if(0<h[p+3]){var t={x:l?(r+c)/m:r+c,y:l?1-(s+c)/o:s+c,radius:d};j.push(t)}r+=c,r>=k&&(r=0,s+=c,p+=4*c*k)}return j}},{key:'ctx',get:function get(){return this.canvas.getContext('2d')}}]),a}();function getFontString(a,b){return'bold '+a+'px "'+b+'"'}function isNumber(a){return!isNaN(parseFloat(a))&&isFinite(a)}

},{}],17:[function(require,module,exports){
'use strict';var _slicedToArray=function(){function a(b,c){var d=[],f=!0,g=!1,h=void 0;try{for(var k,j=b[Symbol.iterator]();!(f=(k=j.next()).done)&&(d.push(k.value),!(c&&d.length===c));f=!0);}catch(l){g=!0,h=l}finally{try{!f&&j['return']&&j['return']()}finally{if(g)throw h}}return d}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError('Invalid attempt to destructure non-iterable instance')}}(),_createClass=function(){function a(b,c){for(var f,d=0;d<c.length;d++)f=c[d],f.enumerable=f.enumerable||!1,f.configurable=!0,'value'in f&&(f.writable=!0),Object.defineProperty(b,f.key,f)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_get=function a(b,c,d){null===b&&(b=Function.prototype);var f=Object.getOwnPropertyDescriptor(b,c);if(f===void 0){var g=Object.getPrototypeOf(b);return null===g?void 0:a(g,c,d)}if('value'in f)return f.value;var h=f.get;return void 0===h?void 0:h.call(d)},_shader=require(19),shader=_interopRequireWildcard(_shader),_utils=require(43),_color2=require(38),_noise=require(41),_math=require(40),_GLDrawer2=require(3),_const=require(5);var _MathPI=Math.PI;Object.defineProperty(exports,'__esModule',{value:!0}),exports.StarDrawer=void 0;function _interopRequireWildcard(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a}function _inherits(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var StarDrawer=exports.StarDrawer=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return _inherits(b,a),_createClass(b,[{key:'createScenes',value:function createScenes(c){var d=this.scene=new Flip.GL.Scene({fragShader:shader.FRAG_SHADER,vertexShader:shader.VERTEX_SHADER,name:'main'});this.geometry=new Flip.GL.Mesh({primitive:Flip.GL.POINTS});var f=c.camera||{},g=this.camera=new Flip.GL.Camera({position:f.position||[0,0,0],lookAt:f.lookAt||[0,0,1],perspective:f.perspective||[_MathPI/8,1,1,5],viewProjectionMatrixUniformName:'uViewProjection'});return this.dragMultiplier=c.dragMultiplier||1/20,d.addBinder(d.buildBinder({uViewProjection:g,uGlobalOpacity:1,uWorldTransform:new Flip.GL.Matrix4,uShinningRadius:[0.2,0.4],uOffset:0,uNoise:(0,_noise.randomNoiseData)({easeFunc:Flip.EASE.sineInOut}),aPoint:new Float32Array(0),aPointColor:new Float32Array(0),blend:function blend(h){h.enable(h.BLEND),h.blendFunc(h.SRC_ALPHA,h.ONE)}})),d.add(this.geometry),this._clock=new Flip.Clock({duration:c.shinningDuration||12,infinite:!0,reverse:!0}),this._clock.start(),[d]}},{key:'update',value:function update(c){_get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),'update',this).call(this,c),this._clock.update(c),this.lightOffset=4*this._clock.current}},{key:'reset',value:function reset(){return this.rotateByY(0),this}},{key:'rotateByY',value:function rotateByY(c){this.scene.binder.uWorldTransform.value=new Flip.GL.Matrix4().rotate(c/180*_MathPI,[0,1,0]),this.invalid()}},{key:'setStars',value:function setStars(c){for(var d=c.length,f=new Float32Array(4*d),g=new Float32Array(3*d),h=0,j=0,k=0;k<c.length;k++){var l=c[k],m=l.pos,n=(0,_utils.isStr)(l.color)?(0,_color2.parseColor)(l.color):l.color;n||(n=COLOR_WHITE),f[h++]=m[0],f[h++]=m[1],f[h++]=m[2],f[h++]=Math.round(l.radius),g[j++]=n[0],g[j++]=n[1],g[j++]=n[2]}this.geometry.drawCount=d,this.scene.binder.aPoint.data=f,this.scene.binder.aPointColor.data=g,this.invalid()}},{key:'viewportResize',value:function viewportResize(c){this.camera.aspect=c.aspectRatio}},{key:'randomPoints',value:function randomPoints(c){for(var d=[],f=_slicedToArray(c.sizeRange,2),g=f[0],h=f[1],j=_slicedToArray(c.posMin,3),k=j[0],l=j[1],m=j[2],n=_slicedToArray(c.posMax,3),o=n[0],p=n[1],q=n[2],r=c.posEase,s=c.sizeEase,t=c.color||[1,1,1],u=0;u<c.count;u++){var w=(0,_math.random)(k,o,r),A=(0,_math.random)(l,p,r),B=(0,_math.random)(m,q,r);d.push({pos:[w,A,B],color:t,radius:(0,_math.random)(g,h,s)})}return d}},{key:'type',get:function get(){return _const.ANIMATION_STAR}},{key:'opacity',get:function get(){return this.scene.binder.uGlobalOpacity.value},set:function set(c){this.scene.binder.uGlobalOpacity.value=c,this.invalid()}},{key:'lightOffset',get:function get(){return this.scene.binder.uOffset.value},set:function set(c){this.lightOffset!=c&&(this.scene.binder.uOffset.value=+c,this.invalid())}}]),b}(_GLDrawer2.GLDrawer),COLOR_WHITE=[1,1,1];

},{"19":19,"3":3,"38":38,"40":40,"41":41,"43":43,"5":5}],18:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:!0}),exports.StarDrawer=void 0,exports.getStarDrawer=getStarDrawer;var _StarDrawer=require(17),_SpottedStringDrawer=require(16);exports.StarDrawer=_StarDrawer.StarDrawer;var defaultSpottedStringDrawer=new _SpottedStringDrawer.SpottedStringDrawer({fontFamily:'Microsoft Yahei,Times New Roman, Georgia, Serif'});function getStarDrawer(){var a=new _StarDrawer.StarDrawer({camera:{position:[0,0,0],lookAt:[0,0,1],perspective:[Math.PI/8,1,-1,-5]},shinningDuration:6,dragMultiplier:1/20}),b=a.randomPoints({sizeRange:[6,18],posMin:[-5,0.8,-5],posMax:[5,1,5],count:320,posEase:Flip.EASE.sineOut,sizeEase:Flip.EASE.quartInOut}),c=defaultSpottedStringDrawer.getPointFromText('Web AR',{normalize:!0,gap:3}).map(function(d){return{pos:[1-d.x,d.y,2],radius:6,color:[1,1,0]}});return a.setStars(b.concat(c)),a}

},{"16":16,"17":17}],19:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var VERTEX_SHADER=exports.VERTEX_SHADER="\nprecision mediump float;\n\nattribute vec4 aPoint;\nattribute vec3 aPointColor;\n\nuniform mat4 uViewProjection;\nuniform mat4 uWorldTransform;\n\nvarying vec3 vPointColor;\nvarying vec2 vNoiseIndex;\n\nvoid main(){\n  vec4 pos = vec4(aPoint.xyz,1.0);\n  vPointColor = aPointColor;\n  gl_Position = pos * uWorldTransform * uViewProjection;\n  gl_PointSize = aPoint.w;\n  vNoiseIndex = pos.xy;\n}\n",FRAG_SHADER=exports.FRAG_SHADER="\nprecision mediump float;\n\nconst float BASE_ALPHA = 0.2;\nconst float SHINNING_ALPHA = 0.8;\n\nvarying vec3 vPointColor;\nvarying vec2 vNoiseIndex;\n\nuniform vec2 uShinningRadius;\nuniform sampler2D uNoise;\nuniform float uOffset;\nuniform float uGlobalOpacity;\nfloat shanningOffset();\n\nvoid main(){\n  vec2 pos = (gl_PointCoord.xy - 0.5) * 2.0;\n  float len = length(pos);\n  if(len >1.0){\n    discard;\n  }\n  float alpha = (1.0 - smoothstep(0.0,1.0,len)) * BASE_ALPHA;\n  float shanningRadius = uShinningRadius[0] + shanningOffset() * uShinningRadius[1];\n  alpha += (1.0 - smoothstep(0.0,shanningRadius,len)) * SHINNING_ALPHA;\n  gl_FragColor = vec4(vPointColor,alpha * uGlobalOpacity);\n}\nfloat shanningOffset(){\n  float noise = length(texture2D(uNoise,vNoiseIndex));\n  float timeOffset = uOffset;\n  return abs(sin((noise+timeOffset) * 3.14159));\n}\n";

},{}],20:[function(require,module,exports){
'use strict';var _createClass=function(){function a(b,c){for(var e,d=0;d<c.length;d++)e=c[d],e.enumerable=e.enumerable||!1,e.configurable=!0,'value'in e&&(e.writable=!0),Object.defineProperty(b,e.key,e)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_shader=require(24),_vertexGenerator=require(25);Object.defineProperty(exports,'__esModule',{value:!0}),exports.CircleShape=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a}function _inherits(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var Vec=Flip.GL.Vec,DEF_CONSTRUCTOR={radius:0.3,position:[0,0,0],shape:_shader.SHAPE_TRANSPARENT},CircleShape=exports.CircleShape=function(a){function b(c){_classCallCheck(this,b);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,{primitive:Flip.GL.TRIANGLE_FAN,drawCount:c.triangleCount||_vertexGenerator.DEFAULT_SECTION_COUNT}));return d.radius=c.radius||DEF_CONSTRUCTOR.radius,d.position=c.position||DEF_CONSTRUCTOR.position,d.shape=c.shape||DEF_CONSTRUCTOR.shape,d.distanceToCenter=c.distance,d}return _inherits(b,a),_createClass(b,[{key:'modelMatrix',get:function get(){var c=this.radius;return Flip.GL.Matrix4.fromTranslate.apply(null,this.position).scale(c,c,c)}},{key:'radius',get:function get(){return this._radius},set:function set(c){this.radius!==+c&&(this._radius=+c,this.invalid())}},{key:'position',get:function get(){return this._pos},set:function set(c){c&&(this._pos=new Vec(c),this.invalid())}}]),b}(Flip.GL.Mesh);

},{"24":24,"25":25}],21:[function(require,module,exports){
'use strict';var _slicedToArray=function(){function a(b,c){var d=[],f=!0,g=!1,h=void 0;try{for(var k,j=b[Symbol.iterator]();!(f=(k=j.next()).done)&&(d.push(k.value),!(c&&d.length===c));f=!0);}catch(m){g=!0,h=m}finally{try{!f&&j['return']&&j['return']()}finally{if(g)throw h}}return d}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError('Invalid attempt to destructure non-iterable instance')}}(),_createClass=function(){function a(b,c){for(var f,d=0;d<c.length;d++)f=c[d],f.enumerable=f.enumerable||!1,f.configurable=!0,'value'in f&&(f.writable=!0),Object.defineProperty(b,f.key,f)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_get=function a(b,c,d){null===b&&(b=Function.prototype);var f=Object.getOwnPropertyDescriptor(b,c);if(f===void 0){var g=Object.getPrototypeOf(b);return null===g?void 0:a(g,c,d)}if('value'in f)return f.value;var h=f.get;return void 0===h?void 0:h.call(d)},_shader=require(24),_vertexGenerator=require(25),_VertexSunLight=require(22),_math=require(40),_GLDrawer2=require(3),_const=require(5);var _Mathsin=Math.sin,_Mathcos=Math.cos,_MathPI=Math.PI;Object.defineProperty(exports,'__esModule',{value:!0}),exports.VertexSunDrawer=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a}function _inherits(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var VertexSunDrawer=exports.VertexSunDrawer=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return _inherits(b,a),_createClass(b,[{key:'createScenes',value:function createScenes(c){var d=new Flip.GL.Scene({vertexShader:_shader.VERTEX_SHADER,fragShader:_shader.FRAG_SHADER,name:'main'}),f=c.camera,g=this.camera=new Flip.GL.Camera({name:'camera',viewProjectionMatrixUniformName:'uViewProjection',position:f.position,lookAt:f.lookAt,perspective:f.perspective||[_MathPI/3,1,1,10]});this.triangleCount=c.sunlight.triangleCount||_vertexGenerator.DEFAULT_SECTION_COUNT,d.addBinder(d.buildBinder({aVertex:(0,_vertexGenerator.generateCircleTriangleFanData)(this.triangleCount,1),uLensFlareOpacity:1,blend:function blend(j){j.enable(j.BLEND),j.blendFunc(j.SRC_ALPHA,j.ONE)}})),d.addBinder(g);var h=this.sunlight=new _VertexSunLight.VertexSunLight(c.sunlight);return h.lensFlares.forEach(function(j){return d.add(j)}),d.add(h.geometry),this.sunlightRotateParam=[0,0],[this.scene=d]}},{key:'viewportResize',value:function viewportResize(c){this.scene.binder.aVertex.data=(0,_vertexGenerator.generateCircleTriangleFanData)(this.triangleCount,1,c.aspectRatio)}},{key:'setSunColor',value:function setSunColor(c){this.setVecUniform(this.sunlight.geometry,'uPointColor',c)}},{key:'addLensFlare',value:function addLensFlare(c){var d=this.sunlight.addLensFlare(c);return this.scene.add(d),this.invalid(),this}},{key:'rotatePositionAndDirection',value:function rotatePositionAndDirection(c){var d=_MathPI*(1-c.percent),f=_MathPI*c.percent,g=this.sunlight,h=g.position[2],j=[_Mathcos(f)*c.lightTargetRadius,c.lightTargetHeight||0,_Mathsin(f)*c.lightTargetRadius],k=rotateInXYSurface(c.rotateRadius,_MathPI/2,h);g.lightDirection=_VertexSunLight.Vec.vecMix(j,1,k,-1),g.position=rotateInXYSurface(c.rotateRadius,d,h),this.setSunColor(c.color),this.invalid()}},{key:'restoreLightDirection',value:function restoreLightDirection(){var c=this.sunlightRotateParam;return this.rotateLightDirection(-c[0],-c[1])}},{key:'rotateLightDirection',value:function rotateLightDirection(c,d){var p,f=this.sunlight,g=f.lightDirection,h=f.position,j=_slicedToArray(this.sunlightRotateParam,2),k=j[0],m=j[1],n=k+c,o=m+d;inRange(-80,80,n)&&(g=(0,_math.vec3RotateY)(g,h,c*_MathPI/180),this.sunlightRotateParam[0]=n,p=!0),inRange(0,10,o)&&(g=(0,_math.vec3RotateX)(g,h,d*_MathPI/180),this.sunlightRotateParam[1]=o,p=!0),p&&(f.lightDirection=g,this.invalid())}},{key:'update',value:function update(c){_get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),'update',this).call(this,c),this.sunlight&&this.sunlight.resetLensFlare()}},{key:'type',get:function get(){return _const.ANIMATION_SUN}},{key:'lensFlaresIntensity',get:function get(){return this.scene.binder.uLensFlareOpacity.value},set:function set(c){this.scene.binder.uLensFlareOpacity.value=c}}]),b}(_GLDrawer2.GLDrawer);function inRange(a,b,c){return c>a&&c<b}function rotateInXYSurface(a,b,c){return[_Mathcos(b)*a,_Mathsin(b)*a,c]}

},{"22":22,"24":24,"25":25,"3":3,"40":40,"5":5}],22:[function(require,module,exports){
'use strict';var _createClass=function(){function a(b,c){for(var e,d=0;d<c.length;d++)e=c[d],e.enumerable=e.enumerable||!1,e.configurable=!0,'value'in e&&(e.writable=!0),Object.defineProperty(b,e.key,e)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_shader=require(24),_CircleShape=require(20);Object.defineProperty(exports,'__esModule',{value:!0}),exports.VertexSunLight=exports.Vec=exports.CircleShapeConstructor=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}exports.CircleShapeConstructor=_CircleShape.CircleShapeConstructor;var Vec=exports.Vec=Flip.GL.Vec,vecAdd=Vec.vecAdd,vecDot=Vec.vecDot,vecNormalize=Vec.vecNormalize,VertexSunLight=exports.VertexSunLight=function(){function a(b){var c=this;_classCallCheck(this,a),this.lensFlares=[],this.position=b.position,this.lightDirection=b.lightDirection,this.triangleCount=b.triangleCount,this.geometry=this.createCircle({shape:_shader.SHAPE_SOLID,radius:b.radius,color:b.color||[1,1,1,1],position:this.position,distance:0}),(b.lensFlares||[]).forEach(function(d){return c.addLensFlare(d)})}return _createClass(a,[{key:'position',get:function get(){return this._position}},{key:'lightDirection',get:function get(){return this._lightDir}}]),_createClass(a,[{key:'addLensFlare',value:function addLensFlare(b){var c=vecAdd(this.position,vecDot(this.lightDirection,b.distance)),d=this.createCircle({position:c,radius:b.radius,distance:b.distance,shape:_shader.SHAPE_TRANSPARENT,color:b.color});return this.lensFlares.push(d),this}},{key:'createCircle',value:function createCircle(b){var c=new _CircleShape.CircleShape(Object.assign({triangleCount:this.triangleCount},b));return c.addBinder(new Flip.GL.Uniform({value:c.shape,name:'uDrawMode'})),c.addBinder(new Flip.GL.Uniform({name:'uModelTransform',value:function value(){return c.modelMatrix}})),b.color&&c.addBinder(new Flip.GL.Uniform({name:'uPointColor',value:new Vec(b.color)})),c}},{key:'resetLensFlare',value:function resetLensFlare(){if(this._needResetLensFlares){var b=this.lightDirection,c=this.position;this.geometry.position=c,this.lensFlares.forEach(function(d){return d.position=vecAdd(c,vecDot(b,d.distanceToCenter))}),this._needResetLensFlares=!1}}},{key:'needResetLensFlares',value:function needResetLensFlares(){this._needResetLensFlares=!0}},{key:'position',set:function set(b){b&&(this._position=new Vec(b),this.needResetLensFlares())}},{key:'lightDirection',set:function set(b){b&&(this._lightDir=vecNormalize(new Vec(b)),this.needResetLensFlares())}}]),a}();

},{"20":20,"24":24}],23:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:!0}),exports.VertexSunDrawer=void 0,exports.getVertexSunDrawer=getVertexSunDrawer,exports.getVertexSunDrawerAnimateParam=getVertexSunDrawerAnimateParam;var _VertexSunDrawer=require(21),_color=require(38),_math=require(40);exports.VertexSunDrawer=_VertexSunDrawer.VertexSunDrawer;var LENS_FLARE_COLOR=[0.9803921568627451,0.9568627450980393,0.9098039215686274,1],DEF_CONFIG={camera:{position:[0,-0.2,3],lookAt:[0,0,0],up:[0,1,0],perspective:[Math.PI/3,1,1,10]},sunlight:{position:[-2.4,0,-0.9],color:[0.9803921568627451,0.9568627450980393,0.9098039215686274,1],lightDirection:[0.8,-0.56,0.24],radius:0.1,lensFlares:[{radius:0.16,distance:0,color:LENS_FLARE_COLOR},{radius:0.06,distance:0.4,color:LENS_FLARE_COLOR},{radius:0.12,distance:0.8,color:LENS_FLARE_COLOR},{radius:0.2,distance:1.6,color:LENS_FLARE_COLOR}],triangleCount:180}};function getVertexSunDrawer(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},b={camera:Object.assign({},DEF_CONFIG.camera,a.camera),sunlight:Object.assign({},DEF_CONFIG.sunlight,a.sunlight)};return new _VertexSunDrawer.VertexSunDrawer(b)}var SUN_COLOR_H0=19/360,SUN_COLOR_S0=.28,SUN_COLOR_V0=1,SUN_COLOR_H1=19/360,SUN_COLOR_S1=.07,SUN_COLOR_V1=1;function getVertexSunDrawerAnimateParam(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,b=2*(0.5<a?1-a:a),c=(0,_color.HSVtoRGB)((0,_math.mapRange)(SUN_COLOR_H0,SUN_COLOR_H1,b),(0,_math.mapRange)(SUN_COLOR_S0,SUN_COLOR_S1,b),(0,_math.mapRange)(SUN_COLOR_V0,SUN_COLOR_V1,b));return{lightTargetHeight:-.5,lightTargetRadius:3,rotateRadius:2.2,percent:a,color:c}}

},{"21":21,"38":38,"40":40}],24:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var SHAPE_TRANSPARENT=exports.SHAPE_TRANSPARENT='2',SHAPE_SOLID=exports.SHAPE_SOLID='1',VERTEX_SHADER=exports.VERTEX_SHADER='\nprecision mediump float;\n\nattribute vec4 aVertex;\nuniform mat4 uModelTransform;\nuniform mat4 uViewProjection;\nvarying float vRadius;\n\nvoid main(){\n  gl_Position = uViewProjection * uModelTransform * vec4(aVertex.xyz,1.0);\n  vRadius = aVertex.w;\n}\n',FRAG_SHADER=exports.FRAG_SHADER='\nprecision mediump float;\n\nconst int DRAW_TRANSPARENT = '+SHAPE_TRANSPARENT+';\nconst int DRAW_SOLID = '+SHAPE_SOLID+';\n\nvarying float vRadius;\nuniform vec4 uPointColor;\nuniform int uDrawMode;\nuniform float uLensFlareOpacity;\nvoid main(){\n  vec4 dest;\n  if(uDrawMode == DRAW_TRANSPARENT){\n    float r = smoothstep(0.0,1.0,vRadius);\n    dest = vec4(uPointColor.rgb, r * uLensFlareOpacity * uPointColor.a);\n  }\n  else if(uDrawMode == DRAW_SOLID){\n    dest = vec4(uPointColor.rgb, uPointColor.a);\n  }\n  else{\n    discard;\n  }\n  gl_FragColor = dest;\n}';

},{}],25:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.generateCircleTriangleFanData=generateCircleTriangleFanData;var DEFAULT_SECTION_COUNT=exports.DEFAULT_SECTION_COUNT=160;function generateCircleTriangleFanData(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:DEFAULT_SECTION_COUNT,b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:1,c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,d=0,e=a-2,f=new Float32Array(4*a);f[0]=f[1]=0,f[2]=d,f[3]=1;for(var k,g=0,h=4,j=2*Math.PI/e;g<=e;g++)k=j*g,f[h++]=Math.cos(k)*b,f[h++]=Math.sin(k)*b*c,f[h++]=d,f[h++]=0;return f}

},{}],26:[function(require,module,exports){
'use strict';var _createClass=function(){function a(b,c){for(var f,d=0;d<c.length;d++)f=c[d],f.enumerable=f.enumerable||!1,f.configurable=!0,'value'in f&&(f.writable=!0),Object.defineProperty(b,f.key,f)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_get=function a(b,c,d){null===b&&(b=Function.prototype);var f=Object.getOwnPropertyDescriptor(b,c);if(f===void 0){var g=Object.getPrototypeOf(b);return null===g?void 0:a(g,c,d)}if('value'in f)return f.value;var h=f.get;return void 0===h?void 0:h.call(d)},_shader=require(27),shader=_interopRequireWildcard(_shader),_GLDrawer2=require(3);Object.defineProperty(exports,'__esModule',{value:!0}),exports.WaveStage=void 0;function _interopRequireWildcard(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a}function _inherits(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var TEX_DATA_FORMAT=Flip.GL.FLOAT,WaveStage=exports.WaveStage=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return _inherits(b,a),_createClass(b,[{key:'createScenes',value:function createScenes(c){var d=c.waveSpeed||1,f=c.aspectRatio||1;this._clock=new Flip.Clock({duration:90,delegate:this});var g=this.waterSampler=createFloatSampler('uWater',{width:1,height:1,data:new Float32Array(4)}),h=this.frambuffer=new Flip.GL.FrameBuffer({dataFormat:TEX_DATA_FORMAT}),j=new Flip.GL.Scene({name:'drop',vertexShader:shader.QUAD_VERTEX_SHADER,fragShader:shader.DROP_FRAG_SHADER});j.addBinder(j.buildBinder({aQuad:new Float32Array([-1,-1,1,-1,-1,1,1,1]),uAspectRatio:f}));var k=new Flip.GL.Scene({name:'update',vertexShader:shader.QUAD_VERTEX_SHADER,fragShader:shader.UPDATE_FRAG_SHADER});k.addBinder(k.buildBinder({uTexSize:[0,0],uWaveSpeed:d,uAspectRatio:f,aQuad:new Float32Array([-1,-1,1,-1,-1,1,1,1])})),k.add(new Flip.GL.Mesh({drawCount:4,primitive:Flip.GL.TRIANGLE_STRIP,beforeDraw:function beforeDraw(m,n){g.bind(m,n),h.bind(m,n)},afterDraw:function afterDraw(m){switchSampler2DTextureWithFBO(g,h),h.unbind(m)}}));var l=new Flip.GL.Scene({name:'refract',vertexShader:shader.QUAD_VERTEX_SHADER,fragShader:shader.REFRACT_FRAG_SHADER});return l.addBinder(l.buildBinder(_defineProperty({uTexSize:[0,0],uBackground0:null,uBackground1:null,uBgTransparent:0,uWaveSpeed:d,uAspectRatio:f},g.name,g))),l.add(new Flip.GL.Mesh({drawCount:4,primitive:Flip.GL.TRIANGLE_STRIP})),[j,k,l]}},{key:'onClockUpdate',value:function onClockUpdate(){this.invalid()}},{key:'update',value:function update(c){_get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),'update',this).call(this,c),this._clock.update(c)}},{key:'addDrop',value:function addDrop(c){var d=this.getScene('drop'),f=this.waterSampler,g=this.frambuffer;d.add(new Flip.GL.Mesh({drawCount:4,primitive:Flip.GL.TRIANGLE_STRIP,binder:d.buildBinder({uCenter:c.center,uRadius:c.radius,uStrength:c.strength}),beforeDraw:function beforeDraw(h,j){f.bind(h,j),g.bind(h,j)},afterDraw:function afterDraw(h){switchSampler2DTextureWithFBO(f,g),g.unbind(h),d.remove(this)}})),this._clock.restart()}},{key:'transitionBackgroundAsync',value:function transitionBackgroundAsync(c,d){var f=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.7;this.setBackground(c,d);var g=this;return Flip.animate({duration:f,onUpdate:function onUpdate(){g.backgroundTransitionPercent=this.percent},onEnd:function onEnd(){g.setBackground(d,d)}}).promise}},{key:'setBackground',value:function setBackground(c,d){var f=this.getScene('refract');f.binder.uBackground0.source=c,f.binder.uTexSize.value=[c.width,c.height],d&&(f.binder.uBackground1.source=d),this.setVecUniform('update','uTexSize',[c.width,c.height])}},{key:'backgroundTransitionPercent',set:function set(c){this.getScene('refract').binder.uBgTransparent.value=c,this.invalid()}},{key:'aspectRatio',set:function set(c){this.setVecUniform('update','uAspectRatio',+c),this.setVecUniform('drop','uAspectRatio',+c)}},{key:'waveSpeed',set:function set(c){this.setVecUniform('update','uWaveSpeed',+c),this.setVecUniform('refract','uWaveSpeed',+c)}}]),b}(_GLDrawer2.GLDrawer);function switchSampler2DTextureWithFBO(a,b){var c=b.texture;b.texture=a.texture,a.texture=c,a.source=null}function createFloatSampler(a,b){return new Flip.GL.Sampler2D({dataFormat:TEX_DATA_FORMAT,name:a,source:b||null})}

},{"27":27,"3":3}],27:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var QUAD_VERTEX_SHADER=exports.QUAD_VERTEX_SHADER="\nprecision mediump float;\nattribute vec2 aQuad;\nvarying vec2 vTexCoord;\nvoid main(){\n  vTexCoord = aQuad/2. + .5;\n  gl_Position = vec4(aQuad, 0.0, 1.0);\n}\n",DROP_FRAG_SHADER=exports.DROP_FRAG_SHADER="\nprecision mediump float;\n\nconst float PI = 3.141592653589793;\nvarying vec2 vTexCoord;\nuniform sampler2D uWater;\nuniform vec2 uCenter;\nuniform float uRadius;\nuniform float uStrength;\nuniform float uAspectRatio;\n\nvoid main() {\n  vec4 info = texture2D(uWater, vTexCoord);\n  vec2 dis = vTexCoord - uCenter;\n  dis.y /= uAspectRatio; \n  float drop = max(0.0, 1.0 - length(dis) / uRadius);\n  drop = 1. - cos(drop * PI);\n  info.r += drop * uStrength;\n  info.b = 1. * drop;\n  gl_FragColor = info;\n}\n",UPDATE_FRAG_SHADER=exports.UPDATE_FRAG_SHADER="\nprecision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D uWater;\nuniform vec2 uTexSize;\nuniform float uWaveSpeed;\nuniform float uAspectRatio;\n\nvoid main() {\n  vec4 info = texture2D(uWater,vTexCoord);\n  vec2 delta = 1./uTexSize;\n  /* calculate average neighbor height */\n  vec2 dx = vec2(delta.x * uWaveSpeed, 0.0);\n  vec2 dy = vec2(0.0, delta.y * uWaveSpeed * uAspectRatio);\n  vec3 vw = texture2D(uWater, vTexCoord - dx).rgb;\n  vec3 ve = texture2D(uWater, vTexCoord + dx).rgb;\n  vec3 vn = texture2D(uWater, vTexCoord - dy).rgb;\n  vec3 vs = texture2D(uWater, vTexCoord + dy).rgb;\n  vec3 average = (vw+ve+vn+vs) * 0.25;\n  \n  /* change the velocity to move toward the average */\n  info.g += (average.r - info.r) * 2.0;\n  /* attenuate the velocity a little so waves do not last forever */\n  info.g *= 0.99;\n  /* move the vertex along the velocity */\n  info.r += info.g;\n  \n  gl_FragColor = info;\n}\n",VISUALIZE_FRAG_SHADER=exports.VISUALIZE_FRAG_SHADER="\nprecision mediump float;\nvarying vec2 vTexCoord;\nuniform sampler2D uWater;\n\nvoid main(){\n  vec4 info = texture2D(uWater,vTexCoord);\n  gl_FragColor = vec4(vec3(info.r),1.0);\n}\n",REFRACT_FRAG_SHADER=exports.REFRACT_FRAG_SHADER="\nprecision mediump float;\nvarying vec2 vTexCoord;\n\nuniform sampler2D uBackground0;\nuniform sampler2D uBackground1;\nuniform float uBgTransparent;\nuniform sampler2D uWater;\nuniform float uWaveSpeed;\nuniform vec2 uTexSize;\nuniform float uAspectRatio;\n\nvec3 getPoint3D(sampler2D tex,vec2 coord);\nvoid main(){\n  vec3 p0 = getPoint3D(uWater,vTexCoord);\n  vec3 p1 = getPoint3D(uWater,vTexCoord + vec2(0.,1./uTexSize.y * uWaveSpeed * uAspectRatio));\n  vec3 p2 = getPoint3D(uWater,vTexCoord + vec2(1./uTexSize.x * uWaveSpeed,0.));\n  vec3 n = normalize(cross(p0-p1,p0-p2));\n  vec3 light = vec3(0.,0.,-1.);\n  vec3 r = refract(light,n,0.8);\n  float k = r.z ==0.?0.:- p0.z /r.z;\n  vec3 pos = p0 + k * r;\n  gl_FragColor = texture2D(uBackground1,pos.xy) * uBgTransparent + (1.-uBgTransparent) * texture2D(uBackground0,pos.xy);\n}\n\nvec3 getPoint3D(sampler2D tex,vec2 coord){\n  float height = texture2D(tex,coord).r;\n  return vec3(coord,height);\n}\n\n";

},{}],28:[function(require,module,exports){
'use strict';var _createClass=function(){function a(b,c){for(var f,d=0;d<c.length;d++)f=c[d],f.enumerable=f.enumerable||!1,f.configurable=!0,'value'in f&&(f.writable=!0),Object.defineProperty(b,f.key,f)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_get=function a(b,c,d){null===b&&(b=Function.prototype);var f=Object.getOwnPropertyDescriptor(b,c);if(f===void 0){var g=Object.getPrototypeOf(b);return null===g?void 0:a(g,c,d)}if('value'in f)return f.value;var h=f.get;return void 0===h?void 0:h.call(d)};Object.defineProperty(exports,'__esModule',{value:!0});function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a}function _inherits(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var DEF_VERTEX_SHADER=function(a){return'\nprecision mediump float;\n\nattribute vec2 aQuad;\nvarying vec2 '+a+';\nuniform bool uFlipXCoord;\nuniform mat3 uFilterRegionTransform;\n\nvoid main(){\n   vec3 pos = uFilterRegionTransform * vec3(aQuad,1.0);\n   vec2 texIndex = pos.xy /2. +.5;\n   if(uFlipXCoord)\n    texIndex.x = 1. - texIndex.x;\n   '+a+' = texIndex;\n   gl_Position = vec4(pos.xy,0.0,1.0);\n}\n'},DEF_FRAGMENT_SHADER=function(a,b){return'\nprecision mediump float;\n\nvarying vec2 '+a+';\n\n'+b+'\n'},COPY_PROGRAM='\nuniform sampler2D uSampler;\n\nvoid main(){\n  gl_FragColor = texture2D(uSampler,vTexIndex);\n}\n',GLFilter=exports.GLFilter=function(a){function b(c){_classCallCheck(this,b);var d=c.texCoordName||'vTexIndex',f=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,{vertexShader:DEF_VERTEX_SHADER(d),fragShader:DEF_FRAGMENT_SHADER(d,c.program||COPY_PROGRAM),define:c.define,name:c.name}));f.addBinder(f.buildBinder(c.binder)),f.addBinder(f.buildBinder({aQuad:[-1,-1,1,-1,-1,1,1,1],uFlipXCoord:!1,uFilterRegionTransform:new Flip.Mat3,uSampler:null}));var g;return g=c.framebuffer instanceof Flip.GL.FrameBuffer?c.framebuffer:new Flip.GL.FrameBuffer(c.framebuffer||{name:'filter-fbo'}),f.fbo=g,f.createMeshes(c).forEach(function(h){h instanceof Flip.GL.Mesh||(h=new Flip.GL.Mesh(Object.assign(h,{drawCount:4,primitive:Flip.GL.TRIANGLE_STRIP}))),f.add(h)}),f}return _inherits(b,a),_createClass(b,[{key:'transformFilterRegion',value:function transformFilterRegion(c){this.binder.uFilterRegionTransform.value=c.clone(),this.invalid()}},{key:'createMeshes',value:function createMeshes(){return[{}]}},{key:'setSource',value:function setSource(c,d,f){var g=this.binder[d];g.data=c,g.dynamicSource=f,this.invalid()}},{key:'getTargetFBOOwner',value:function getTargetFBOOwner(){return this}},{key:'setTarget',value:function setTarget(c,d){var f=this.fbo;this.target&&this.target.removeBinder(this._targetBinder),d||(d='uSampler');var g=this._targetBinder=f.createSampler2D(d,!1);g.name=d,this.target=c;var h=this.getTargetFBOOwner();c?h.addBinder(f):h.removeBinder(f),c.removeBinder(d),c.addBinder(g)}},{key:'dispose',value:function dispose(c){_get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),'dispose',this).call(this,c),this.fbo.dispose(c)}},{key:'sourceBinder',get:function get(){return this.binder.uSampler}},{key:'source',set:function set(c){var d=this.sourceBinder;d.source=c;var f=c instanceof HTMLVideoElement;d.dynamicSource=f,this.binder.uFlipXCoord.value=f}}]),b}(Flip.GL.Scene);

},{}],29:[function(require,module,exports){
'use strict';var _createClass=function(){function a(b,c){for(var f,d=0;d<c.length;d++)f=c[d],f.enumerable=f.enumerable||!1,f.configurable=!0,'value'in f&&(f.writable=!0),Object.defineProperty(b,f.key,f)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_GLFilter2=require(28);Object.defineProperty(exports,'__esModule',{value:!0}),exports.MirrorFilter=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a}function _inherits(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var FRAG_SHADER='\nuniform sampler2D uSampler;\nuniform float uAlpha;\nvoid main(){\n  vec3 color = texture2D(uSampler,vTexIndex).rgb;\n  vec2 pos =(vTexIndex - .5) * 2.;\n  float len =length(pos);\n  \n  float a = uAlpha * (1.-smoothstep(0.3,1.0,len));\n  gl_FragColor = vec4(color,a);\n}\n',MirrorFilter=exports.MirrorFilter=function(a){function b(c){_classCallCheck(this,b),c.program=FRAG_SHADER;var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c));return d.addBinder(d.buildBinder({uAlpha:isNaN(c.alpha)?0.5:c.alpha,blend:function blend(f){f.enable(f.BLEND),f.blendFunc(f.SRC_ALPHA,f.ONE_MINUS_SRC_ALPHA)}})),d}return _inherits(b,a),_createClass(b,[{key:'alpha',get:function get(){return this.binder.uAlpha.value},set:function set(c){this.alpha!=c&&(this.binder.uAlpha.value=+c,this.invalid())}}]),b}(_GLFilter2.GLFilter);

},{"28":28}],30:[function(require,module,exports){
'use strict';var _createClass=function(){function a(b,c){for(var e,d=0;d<c.length;d++)e=c[d],e.enumerable=e.enumerable||!1,e.configurable=!0,'value'in e&&(e.writable=!0),Object.defineProperty(b,e.key,e)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_GLFilter2=require(28),_shader=require(32),shader=_interopRequireWildcard(_shader);Object.defineProperty(exports,'__esModule',{value:!0}),exports.OpeningFilter=void 0;function _interopRequireWildcard(a){if(a&&a.__esModule)return a;var b={};if(null!=a)for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(b[c]=a[c]);return b.default=a,b}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a}function _inherits(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var OpeningFilter=exports.OpeningFilter=function(a){function b(c){_classCallCheck(this,b),c.program=shader.MORPHOLOGICAL_FRAG_SHADER(c.window||3);var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c));return d.addBinder(d.buildBinder({uTexSize:[0,0]})),d}return _inherits(b,a),_createClass(b,[{key:'getTargetFBOOwner',value:function getTargetFBOOwner(){return this.children[1]}},{key:'createMeshes',value:function createMeshes(){var d=new Flip.GL.FrameBuffer({name:'fbo'});return[{binder:this.buildBinder({uProcess:shader.MORPHOLOGICAL_PROCESS_EROSION,framebuffer:d})},{binder:this.buildBinder({uProcess:shader.MORPHOLOGICAL_PROCESS_DILATION,uSampler:d.createSampler2D('uSampler')})}]}},{key:'size',set:function set(c){this.binder.uTexSize.value=c,this.invalid()}},{key:'input',set:function set(c){var d=this.binder.uSampler;d.source=c,d.dynamicSource=c instanceof HTMLVideoElement,this.invalid()}}]),b}(_GLFilter2.GLFilter);

},{"28":28,"32":32}],31:[function(require,module,exports){
'use strict';var _createClass=function(){function a(b,c){for(var e,d=0;d<c.length;d++)e=c[d],e.enumerable=e.enumerable||!1,e.configurable=!0,'value'in e&&(e.writable=!0),Object.defineProperty(b,e.key,e)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_GLFilter2=require(28);Object.defineProperty(exports,'__esModule',{value:!0}),exports.EDGE_FRAG_SHADER=exports.SobelEdgeFilter=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a}function _inherits(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var SobelEdgeFilter=exports.SobelEdgeFilter=function(a){function b(c){_classCallCheck(this,b),c.program=EDGE_FRAG_SHADER;var d=_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,c));return d.addBinder(d.buildBinder({uEdgeScale:c.threshold||3,uTexSize:[0,0]})),d}return _inherits(b,a),_createClass(b,[{key:'size',set:function set(c){this.binder.uTexSize.value=c}}]),b}(_GLFilter2.GLFilter),EDGE_FRAG_SHADER=exports.EDGE_FRAG_SHADER='\n  \n  uniform vec2 uTexSize;\n  uniform float uEdgeScale;\n  uniform sampler2D uSampler;\n  \n  void main(){\n    vec2 texInc = 1./uTexSize;\n    vec3 ret=vec3(0.0);\n    #define texLum(x,y) texture2D(uSampler,vec2(x,y) * texInc + vTexIndex).rgb\n    vec3 t = texLum(0.,-1.);\n    vec3 b = texLum(0.,1.);\n    vec3 l = texLum(-1.,0.);\n    vec3 r = texLum(1.,0.);\n    vec3 lt = texLum(-1.,-1.);\n    vec3 lb = texLum(-1.,1.);\n    vec3 rt = texLum(1.,-1.);\n    vec3 rb = texLum(1.,1.);\n    vec3 h = lt + 2.* t + rt - lb - 2.* b - rb;\n    vec3 v = lt + 2.* l + lb - rt - 2.* r - rb;\n    float lum =any(greaterThan((abs(v)+abs(h)),vec3(0.5 * uEdgeScale))) ? 1.:0.;\n    \n    gl_FragColor = vec4(vec3(lum),1.0);\n  }\n  \n';

},{"28":28}],32:[function(require,module,exports){
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var MORPHOLOGICAL_PROCESS_EROSION=exports.MORPHOLOGICAL_PROCESS_EROSION=1,MORPHOLOGICAL_PROCESS_DILATION=exports.MORPHOLOGICAL_PROCESS_DILATION=2,MORPHOLOGICAL_FRAG_SHADER=exports.MORPHOLOGICAL_FRAG_SHADER=function(a){return"\n  const int PROCESS_EROSION ="+MORPHOLOGICAL_PROCESS_EROSION+";\n  const int PROCESS_DILATION = "+MORPHOLOGICAL_PROCESS_DILATION+";\n  \n  const int _ws = "+-parseInt((a-1)/2)+";\n  const int _we = "+parseInt((a-1)/2)+";\n  uniform sampler2D uSampler;\n  uniform vec2 uTexSize;\n  uniform int uProcess;\n  \n  vec3 erosion(sampler2D tex,vec2 index,vec2 inc);\n  vec3 dilation(sampler2D tex,vec2 index,vec2 inc);\n  \n  void main(){\n    vec3 ret= vec3(0.0);\n    float a =1.;\n    if(uProcess == PROCESS_EROSION){\n      ret = erosion(uSampler,vTexIndex,1./uTexSize);\n    }\n    else if(uProcess == PROCESS_DILATION){\n      ret = dilation(uSampler,vTexIndex,1./uTexSize);\n    }\n    else{\n      ret = texture2D(uSampler,vTexIndex).rgb;\n    }\n    gl_FragColor = vec4(ret,1.0);\n  }\n  \n  #define t(a,b) texture2D(tex,index + vec2(a,b) * inc).rgb\n  vec3 erosion(sampler2D tex,vec2 index,vec2 inc){\n    vec3 _zero = vec3(0.0);\n    for(int x = _ws;x <= _we;x++){\n      for(int y= _ws;y <= _we;y++){\n        vec3 c = t(float(x),float(y));\n        if(any(equal(c,_zero))){\n          return vec3(0.0);\n        }\n      }\n    }\n    return vec3(1.0);\n  }\n  vec3 dilation(sampler2D tex,vec2 index,vec2 inc){\n    vec3 _zero = vec3(0.0);\n    for(int x = _ws;x <= _we;x++){\n      for(int y= _ws;y <= _we;y++){\n        vec3 c = t(float(x),float(y));\n        if(any(greaterThan(c,_zero))){\n          return vec3(1.0);\n        }\n      }\n    }\n    return vec3(0.0);\n  }\n"};

},{}],33:[function(require,module,exports){
'use strict';var _webrtc=require(45),_setup=require(42),_VideoStage=require(36),_BackgroundWorker=require(34),_workerMsg=require(37),_animation=require(1),_ProcessWindow=require(35),processFrame={x:0,y:-.6,size:64},animations=['none','snow','rain','sun','moon'],stage=new _VideoStage.VideoStage,worker=new _BackgroundWorker.BackgroundWorker(Flip.$('#worker').value),predictReady=!1,processWindow=new _ProcessWindow.ProcessWindow,currentAnimation=void 0;worker.onmessage(_workerMsg.MSG_EVENT_WORKER_READY,function(){worker.postMessage(_workerMsg.MSG_EVENT_INIT_NET)}),worker.onmessage(_workerMsg.MSG_EVENT_INIT_NET,function(){predictReady=!0}),worker.onmessage(_workerMsg.MSG_EVENT_PREDICT,function(a){processWindow.push(a);var b=processWindow.currentIndex;-1<b&&!(0,_animation.isTransitioning)()&&currentAnimation!=animations[b]&&(0,_animation.transitionAnimationAsync)(currentAnimation=animations[b])}),(0,_webrtc.getCameraVideoOfSizeAsync)().then(function(a){var b=a.video,c=a.size;stage.size=c,stage.processFrame=processFrame,stage.source=b,(0,_setup.setGLCanvasSize)(c[0],c[1]),stage.add(createCaptureRender(Flip.$('#capture-cvs'))),(0,_setup.init)({drawers:[stage]})});function createCaptureRender(a){var b=a.getContext('2d'),c=new Flip.GL.Render({name:'capture'});return c.render=function(f){if(predictReady&&!worker.busy&&!(0,_animation.isTransitioning)()){var g=stage.captureFrame(f.gl,processFrame);worker.postMessage(_workerMsg.MSG_EVENT_PREDICT,g,[g.data.buffer])}},c}

},{"1":1,"34":34,"35":35,"36":36,"37":37,"42":42,"45":45}],34:[function(require,module,exports){
'use strict';var _createClass=function(){function a(b,c){for(var f,d=0;d<c.length;d++)f=c[d],f.enumerable=f.enumerable||!1,f.configurable=!0,'value'in f&&(f.writable=!0),Object.defineProperty(b,f.key,f)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_workerMsg=require(37);Object.defineProperty(exports,'__esModule',{value:!0}),exports.BackgroundWorker=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var BackgroundWorker=exports.BackgroundWorker=function(){function a(b){_classCallCheck(this,a);var c=this._worker=new Worker(b),d=this._handler={};this.busy=!1,this.ready=!1;var f=this;c.onmessage=function(g){var h=g.data,j=h.type;j==_workerMsg.MSG_EVENT_WORKER_READY&&(f.ready=!0);var k=d[h.type];k&&k[h.success?0:1](h.data),f.busy=!1},c.onerror=function(g){f.busy=!1,console.error('worker error:',g)}}return _createClass(a,[{key:'postMessage',value:function postMessage(b,c,d){!this.busy&&this.ready&&(this._worker.postMessage({type:b,data:c},d||[]),this.busy=!1)}},{key:'onmessage',value:function onmessage(b,c,d){this._handler[b]=[c||noop,d||noop]}}]),a}();function noop(){}

},{"37":37}],35:[function(require,module,exports){
"use strict";var _createClass=function(){function a(b,c){for(var f,e=0;e<c.length;e++)f=c[e],f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(b,f.key,f)}return function(b,c,e){return c&&a(b.prototype,c),e&&a(b,e),b}}();Object.defineProperty(exports,"__esModule",{value:!0});function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var ProcessWindow=exports.ProcessWindow=function(){function a(){_classCallCheck(this,a),this.accumulateThreshold=5,this.passThreshold=0.8,this._currentIndex=-1,this._accumulation=0}return _createClass(a,[{key:"push",value:function push(b){b=Array.from(b);var c=Math.max.apply(Math,b);if(c>this.passThreshold){var e=b.indexOf(c);this._currentIndex==e?this._accumulation++:(this._accumulation=0,this._currentIndex=e)}else this._currentIndex=-1}},{key:"currentIndex",get:function get(){return this._accumulation>this.accumulateThreshold?this._currentIndex:-1}}]),a}();

},{}],36:[function(require,module,exports){
'use strict';var _createClass=function(){function a(b,c){for(var f,d=0;d<c.length;d++)f=c[d],f.enumerable=f.enumerable||!1,f.configurable=!0,'value'in f&&(f.writable=!0),Object.defineProperty(b,f.key,f)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_OpeningFilter=require(30),_SobelEdgeFilter=require(31),_GLFilter=require(28),_MirrorFilter=require(29),_GLDrawer2=require(3);Object.defineProperty(exports,'__esModule',{value:!0}),exports.VideoStage=void 0;function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError('this hasn\'t been initialised - super() hasn\'t been called');return b&&('object'==typeof b||'function'==typeof b)?b:a}function _inherits(a,b){if('function'!=typeof b&&null!==b)throw new TypeError('Super expression must either be null or a function, not '+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var VideoStage=exports.VideoStage=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return _inherits(b,a),_createClass(b,[{key:'createScenes',value:function createScenes(c){var d=this,f=new _SobelEdgeFilter.SobelEdgeFilter({name:'edge',threshold:0.5}),g=new _OpeningFilter.OpeningFilter({name:'process'}),h=c.debug?new _GLFilter.GLFilter({name:'origin'}):new _MirrorFilter.MirrorFilter({name:'origin'});f.setTarget(g);var j=new Flip.GL.Mesh({});return j.render=function(k){return d.delegate&&d.delegate.processFrameEnd(d,k.gl)},g.add(j),this.delegate=c.delegate,[h,f,g]}},{key:'captureFrame',value:function captureFrame(c,d){d=d||this.processFrame;var f=parseInt(c.drawingBufferWidth*(d.x/2+.5)),g=parseInt(c.drawingBufferHeight*(d.y/2+.5)),h=d.size,j=h/2,k=new Uint8Array(4*(h*h));return c.readPixels(f-j,g-j,h,h,c.RGBA,c.UNSIGNED_BYTE,k),new ImageData(new Uint8ClampedArray(k),h,h)}},{key:'processFrame',get:function get(){return this._processFrame},set:function set(c){var d=this._size,f=new Flip.Mat3;d&&c&&f.translate(c.x,c.y).scale(c.size/d[0],c.size/d[1]),this.getScene('edge').transformFilterRegion(f),this.getScene('process').transformFilterRegion(f),this._processFrame=c}},{key:'source',set:function set(c){this.getScene('edge').source=c,this.getScene('origin').source=c}},{key:'size',set:function set(c){var d=[+c[0],+c[1]];this.getScene('edge').size=d,this.getScene('process').size=d,this._size=d,this.processFrame=this.processFrame}}]),b}(_GLDrawer2.GLDrawer);

},{"28":28,"29":29,"3":3,"30":30,"31":31}],37:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:!0});var MSG_EVENT_INIT_NET=exports.MSG_EVENT_INIT_NET='init-net',MSG_EVENT_PREDICT=exports.MSG_EVENT_PREDICT='predict',MSG_EVENT_WORKER_READY=exports.MSG_EVENT_WORKER_READY='worker-ready';

},{}],38:[function(require,module,exports){
'use strict';var _Mathround=Math.round;Object.defineProperty(exports,'__esModule',{value:!0}),exports.randomColorText=randomColorText,exports.randomColor=randomColor,exports.parseColor=parseColor,exports.HSVtoRGB=HSVtoRGB,exports.RGBtoHSV=RGBtoHSV;var COLORS=exports.COLORS='f44336,e91e63,9c27b0,673ab7,3f51b5,2196f3,03a9f4,cccccc,00bcd4,009688,4caf50,8bc34a,cddc39,ffeb3b,ffc107,ff9800,ff5722,795548,9e9e9e,607d8b'.split(',').map(function(c){return parseColor('#'+c)});function randomColorText(){function c(k){return _Mathround(255*j[k])}var e=_Mathround(Math.random()*(COLORS.length-1)),j=COLORS[e];return'rgb('+c(0)+','+c(1)+','+c(2)+')'}function randomColor(){var c=_Mathround(Math.random()*(COLORS.length-1));return normalizeColor(COLORS[c])}function parseColor(c){var e=parseColorText(c);return normalizeColor(e)}function normalizeColor(c){var e;return e=3==c.length?1:c[3],new Float32Array([c[0]/255,c[1]/255,c[2]/255,e])}function parseColorText(c){if(/^rgba?\(([\d,\.]+)\)/.test(c))return RegExp.$1.split(',').map(function(e){return+e});if('#'==c[0]){var e=c.substr(1);if(3==e.length)return e.match(/[a-f\d]/g).map(function(j){return parseInt(j+j,16)});if(6==e.length)return e.match(/[a-f\d]{2}/g).map(function(j){return parseInt(j,16)})}throw Error('invalid color text:'+c)}function HSVtoRGB(c,e,j){var k,l,m,n,o,u,w,x;switch(n=Math.floor(6*c),o=6*c-n,u=j*(1-e),w=j*(1-o*e),x=j*(1-(1-o)*e),n%6){case 0:k=j,l=x,m=u;break;case 1:k=w,l=j,m=u;break;case 2:k=u,l=j,m=x;break;case 3:k=u,l=w,m=j;break;case 4:k=x,l=u,m=j;break;case 5:k=j,l=u,m=w;}return[k,l,m,1]}function RGBtoHSV(c,e,j){var n,k=Math.max(c,e,j),l=Math.min(c,e,j),m=k-l,o=0===k?0:m/k;return k===l?n=0:k===c?(n=e-j+m*(e<j?6:0),n/=6*m):k===e?(n=j-c+2*m,n/=6*m):k===j?(n=c-e+4*m,n/=6*m):void 0,[n,o,k/255]}

},{}],39:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:!0}),exports.loadImageAsync=loadImageAsync;function loadImageAsync(a){if('string'==typeof a){var b=a;a=new Image,a.src=b,a.crossOrigin='*'}return a.complete?Promise.resolve(a):new Promise(function(b,c){a.addEventListener('load',function(){return b(a)}),a.addEventListener('error',c)})}

},{}],40:[function(require,module,exports){
"use strict";var _Mathsin=Math.sin,_Mathcos=Math.cos;Object.defineProperty(exports,"__esModule",{value:!0}),exports.random=random,exports.parseSqrt=parseSqrt,exports.mapRange=mapRange,exports.vec3RotateX=vec3RotateX,exports.vec3RotateY=vec3RotateY;function random(d,e,f){var g=Math.random();return f&&(g=f(g)),g*(e-d)+d}function parseSqrt(d){var e=Math.sqrt(d),f=Math.ceil(e),g=Math.floor(e);return f*g>=d?[f,g]:[f,g+1]}function mapRange(d,e,f){return d+(e-d)*f}function vec3RotateX(d,e,f){var g=[],h=[],i=[];return g[0]=d[0]-e[0],g[1]=d[1]-e[1],g[2]=d[2]-e[2],h[0]=g[0],h[1]=g[1]*_Mathcos(f)-g[2]*_Mathsin(f),h[2]=g[1]*_Mathsin(f)+g[2]*_Mathcos(f),i[0]=h[0]+e[0],i[1]=h[1]+e[1],i[2]=h[2]+e[2],i}function vec3RotateY(d,e,f){var g=[],h=[],i=[];return g[0]=d[0]-e[0],g[1]=d[1]-e[1],g[2]=d[2]-e[2],h[0]=g[2]*_Mathsin(f)+g[0]*_Mathcos(f),h[1]=g[1],h[2]=g[2]*_Mathcos(f)-g[0]*_Mathsin(f),i[0]=h[0]+e[0],i[1]=h[1]+e[1],i[2]=h[2]+e[2],i}

},{}],41:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:!0}),exports.randomNoiseData=randomNoiseData;var _math=require(40);function randomNoiseData(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},b=a.easeFunc,c=a.format,d=a.size,e=d===void 0?256:d,f=a.min,g=f===void 0?0:f,h=a.max,j=h===void 0?1:h,k=void 0;switch(c){case Flip.GL.LUMINANCE:case Flip.GL.ALPHA:k=1;break;case Flip.GL.RGB:k=3;break;case Flip.GL.RGBA:k=4;break;default:c=Flip.GL.LUMINANCE,k=1;}for(var l=new Uint8Array(k*e*e),m=0,n=l.length;m<n;m++)l[m]=255*(0,_math.random)(g,j,b);return{format:c,data:l,width:e,height:e}}

},{"40":40}],42:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:!0}),exports.init=init,exports.setGLCanvasSize=setGLCanvasSize;var _GLRenderPipeline=require(4),task=void 0;function init(a){var b=a.fullScreen,c=a.drawers,e=a.renders,f=Flip.$('#gl-cvs');task=new _GLRenderPipeline.GLRenderPipeline({name:'test-gl',canvas:f,display:b?_GLRenderPipeline.CANVAS_DISPLAY_MODE_FULL_SCREEN:_GLRenderPipeline.CANVAS_DISPLAY_MODE_ORIGIN,clear:Flip.GL.COLOR_BUFFER_BIT}),task.init({preserveDrawingBuffer:!0}),e&&e.forEach(function(g){return task.add(g)}),Flip.instance.add(task),c.forEach(function(g){return task.addDrawer(g)})}function setGLCanvasSize(a,b){var c=Flip.$('#gl-cvs');c.width=a,c.height=b}

},{"4":4}],43:[function(require,module,exports){
'use strict';var _typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&'function'==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?'symbol':typeof a};Object.defineProperty(exports,'__esModule',{value:!0});exports.forEach=forEach,exports.isFunc=isFunc,exports.isObj=isObj,exports.isStr=isStr,exports.noop=noop;function forEach(a,b,c){if(isObj(a))if(void 0===c&&(c=a),a instanceof Array||a.hasOwnProperty('length'))for(var d=0,e=a.length;d<e;d++)b.call(c,a[d],d);else for(var d in a)a.hasOwnProperty(d)&&b.call(c,a[d],d);return a}function isFunc(a){return'function'==typeof a}function isObj(a){return a&&'object'===('undefined'==typeof a?'undefined':_typeof(a))}function isStr(a){return'string'==typeof a}function noop(){}

},{}],44:[function(require,module,exports){
(function (global){
'use strict';var _Mathceil=Math.ceil;Object.defineProperty(exports,'__esModule',{value:!0}),exports.createViewport=createViewport,exports.viewportEquals=viewportEquals,exports.alignCanvas=alignCanvas;var defaultDPI=exports.defaultDPI=global.devicePixelRatio||1;function createViewport(a,b,c){a=_Mathceil(a),b=_Mathceil(b);var d=a/b;return c=c||defaultDPI,Object.freeze({width:+a,height:+b,aspectRatio:d,displayWidth:_Mathceil(a/c),displayHeight:_Mathceil(b/c)})}function viewportEquals(a,b){return a&&b&&a.width===b.width&&a.height===b.height}function alignCanvas(a){var b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},c=b.element,d=c===void 0?document.documentElement:c,e=b.dpi,f=e===void 0?defaultDPI:e,g=b.extendScroll,h=a.style,i=d.clientWidth,j=d.clientHeight;a.width=i*f,a.height=j*f,h.width=i+'px',h.height=j+'px',g&&(h.position='fixed',h.left=0,h.top=0)}

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],45:[function(require,module,exports){
'use strict';Object.defineProperty(exports,'__esModule',{value:!0}),exports.getCameraVideoOfSizeAsync=getCameraVideoOfSizeAsync;function getCameraVideoOfSizeAsync(a){return a||(a=[DEF_VIDEO_WIDTH,DEF_VIDEO_HEIGHT]),new Promise(function(b,c){navigator.mediaDevices.getUserMedia({audio:!1,video:{width:a[0],height:a[1]}}).then(function(d){var e=document.createElement('video');e.srcObject=d,e.play(),e.addEventListener('canplay',function f(){b({video:e,size:a}),e.removeEventListener('canplay',f)})},c)})}var DEF_VIDEO_WIDTH=exports.DEF_VIDEO_WIDTH=640,DEF_VIDEO_HEIGHT=exports.DEF_VIDEO_HEIGHT=480;

},{}]},{},[33]);
